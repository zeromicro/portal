<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="zeromicro">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="icon" href="https://go-zero.dev/favicon.png">
<link rel="icon" href="https://go-zero.dev/favicon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="https://go-zero.dev/img/icons/apple-180x180.png" sizes="180x180">
<meta name="msapplication-config" content="/browserconfig.xml">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="go-zero Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="go-zero Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XZD0YKV3XQ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XZD0YKV3XQ",{anonymize_ip:!0})</script>
<link rel="manifest" href="//manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c"><title data-react-helmet="true">Token Limit | go-zero</title><meta data-react-helmet="true" property="og:image" content><meta data-react-helmet="true" name="twitter:image" content><meta data-react-helmet="true" name="twitter:description" content="go-zero ÊòØ‰∏Ä‰∏™ÈõÜÊàê‰∫ÜÂêÑÁßçÂ∑•Á®ãÂÆûË∑µÁöÑ web Âíå rpc Ê°ÜÊû∂„ÄÇÈÄöËøáÂºπÊÄßËÆæËÆ°‰øùÈöú‰∫ÜÂ§ßÂπ∂ÂèëÊúçÂä°Á´ØÁöÑÁ®≥ÂÆöÊÄßÔºåÁªèÂèó‰∫ÜÂÖÖÂàÜÁöÑÂÆûÊàòÊ£ÄÈ™å„ÄÇ"><meta data-react-helmet="true" name="twitter:title" content="Introduction | go-zero"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;Introduction | go-zero&quot;"><meta data-react-helmet="true" property="og:title" content="Token Limit | go-zero"><meta data-react-helmet="true" name="description" content="This section will introduce its basic usage through token limit (tokenlimit)."><meta data-react-helmet="true" property="og:description" content="This section will introduce its basic usage through token limit (tokenlimit)."><link rel="stylesheet" href="/assets/css/styles.2224638b.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="">
<meta itemprop="description" content="go-zero ÊòØ‰∏Ä‰∏™ÈõÜÊàê‰∫ÜÂêÑÁßçÂ∑•Á®ãÂÆûË∑µÁöÑ web Âíå rpc Ê°ÜÊû∂„ÄÇÈÄöËøáÂºπÊÄßËÆæËÆ°‰øùÈöú‰∫ÜÂ§ßÂπ∂ÂèëÊúçÂä°Á´ØÁöÑÁ®≥ÂÆöÊÄßÔºåÁªèÂèó‰∫ÜÂÖÖÂàÜÁöÑÂÆûÊàòÊ£ÄÈ™å„ÄÇ">
<meta itemprop="url" content="https://go-zero.dev">
<meta itemprop="logo" content="https://go-zero.dev/img/favicon.png">
<meta itemprop="sameAs" content="https://github.com/zeromicro">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar_wBc8 navbar--light navbar--fixed-top"><div class="navbar__inner inner_Y8Z6"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="brand_AtiA" href="/"><img alt="logo" height="30" src="/img/navbar/logo.svg" class="brand_logo_MqNk"><a class="navbar__brand brand_name_O39n">go-zero</a></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/prepare/prepare">Preparation</a></li><li><a class="dropdown__link" href="/docs/quick-start/quick-start">Getting Started</a></li><li><a class="dropdown__link" href="/docs/advance/advance">Guides</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" sidebarid="goctl">Goctl</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/goctl/installation">Installation</a></li><li><a class="dropdown__link" href="/docs/goctl/api">API Command</a></li><li><a class="dropdown__link" href="/docs/goctl/zrpc">RPC Command</a></li><li><a class="dropdown__link" href="/docs/goctl/model">Model Command</a></li><li><a class="dropdown__link" href="/docs/goctl/completion">Completion</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Tool</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/eco/plugins">Goctl Plugin</a></li><li><a class="dropdown__link" href="/docs/eco/editor">Editor Plugin</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/community/about-us">About us</a></li><li><a class="dropdown__link" href="/docs/community/showcase">Showcase</a></li><li><a class="dropdown__link" href="/docs/community/contribute">Contributing</a></li><li><a class="dropdown__link" href="/docs/community/contributor">Contributor</a></li><li><a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub</a></li><li><a href="https://discord.gg/4JQvC5A4Fe" target="_blank" rel="noopener noreferrer" class="dropdown__link">Discord</a></li></ul></div><a class="navbar__item navbar__link" sidebarid="blog" href="/docs/blog/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">More</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/resource-center/learning-resource">Resource Center</a></li><li><a href="https://space.bilibili.com/389552232/channel/seriesdetail?sid=2122723" target="_blank" rel="noopener noreferrer" class="dropdown__link">Video Tutorial</a></li><li><a href="https://github.com/zeromicro/go-zero/blob/master/ROADMAP.md" target="_blank" rel="noopener noreferrer" class="dropdown__link">Development Roadmap</a></li><li><a class="dropdown__link" href="/docs/design/design">Design Docs</a></li><li><a class="dropdown__link" href="/docs/faq/troubleshooting">FAQ</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="searchWrapper_f8aU"><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_CDc6"><kbd class="searchHint_2RRg">ctrl</kbd><kbd class="searchHint_2RRg">K</kbd></div></div></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/docs/blog/governance/tokenlimit" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/cn/docs/blog/governance/tokenlimit" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">‰∏≠ÊñáÁÆÄ‰Ωì</a></li></ul></div><a href="https://github.com/zeromicro/go-zero" class="navbar__items navbar__items--right"><img alt="forks" height="30" src="/img/navbar/github.svg" class="star__fork_dBtt"><div class="star_fork_layout_ROo5"><img alt="stars" height="20" src="https://img.shields.io/github/stars/zeromicro/go-zero?style=social" class="star__fork_dBtt"><img alt="forks" height="20" src="https://img.shields.io/github/forks/zeromicro/go-zero?style=social" class="star__fork_dBtt"></div></a><div class="react-toggle themeToggleInHeading_b3Mq react-toggle--checked react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV" style="margin-left:2px">üåô</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV" style="margin-left:1px">‚òÄ</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_AtiA" href="/">go-zero</a><div class="react-toggle themeToggleInSidebar_qGRI react-toggle--checked react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV" style="margin-left:2px">üåô</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV" style="margin-left:1px">‚òÄ</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist"><span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>Languages</span></span></a><ul class="menu__list"><li class="menu__list-item"><a href="/docs/blog/governance/tokenlimit" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li class="menu__list-item"><a href="/cn/docs/blog/governance/tokenlimit" target="_self" rel="noopener noreferrer" class="menu__link" style="text-transform:capitalize">‰∏≠ÊñáÁÆÄ‰Ωì</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Docs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/prepare/prepare">Preparation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/quick-start/quick-start">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/advance/advance">Guides</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist" sidebarid="goctl">Goctl</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/goctl/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/goctl/api">API Command</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/goctl/zrpc">RPC Command</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/goctl/model">Model Command</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/goctl/completion">Completion</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Tool</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/eco/plugins">Goctl Plugin</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/eco/editor">Editor Plugin</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Community</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/community/about-us">About us</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/community/showcase">Showcase</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/community/contribute">Contributing</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/community/contributor">Contributor</a></li><li class="menu__list-item"><a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://discord.gg/4JQvC5A4Fe" target="_blank" rel="noopener noreferrer" class="menu__link">Discord</a></li></ul></li><li class="menu__list-item"><a class="menu__link" sidebarid="blog" href="/docs/blog/blog">Blog</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">More</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/resource-center/learning-resource">Resource Center</a></li><li class="menu__list-item"><a href="https://space.bilibili.com/389552232/channel/seriesdetail?sid=2122723" target="_blank" rel="noopener noreferrer" class="menu__link">Video Tutorial</a></li><li class="menu__list-item"><a href="https://github.com/zeromicro/go-zero/blob/master/ROADMAP.md" target="_blank" rel="noopener noreferrer" class="menu__link">Development Roadmap</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/design/design">Design Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/faq/troubleshooting">FAQ</a></li></ul></li></ul></div></div></div></nav><div class="wrapper_DIJ0"><div class="doc_D+rh"><div class="doc__sidebar_gVFN" role="complementary"><div class="sidebar_LIo8"><div class="menu menu--responsive thin-scrollbar menu_oAhv"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_nrF-" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" href="/docs/blog/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u menu__link--sublist menu__link--active" href="#!">Governance</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/docs/blog/governance/bloom">Bloom Filter</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/docs/blog/governance/breaker-algorithms">Fusing Principle and Implementation</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/docs/blog/governance/loadshedding">Load Shedding</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/docs/blog/governance/periodlimit">Period Limit</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menuLink_Zq3u menu__link--active active" tabindex="0" href="/docs/blog/governance/tokenlimit">Token Limit</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Cache</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/cache/cache">DB caching mechanism</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/cache/redis-cache">go-zero cache design for persistence layer cache</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/cache/business-cache">go-zero cache design for business-level caching</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/cache/collection">Caching via collection</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Components</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/tool/executors">Executors</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/tool/keywords">Efficient keyword replacement and sensitive word filtering tool</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/tool/logx">logx</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Concurrency</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/concurrency/fx">Fx</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/concurrency/mapreduce">Mapreduce</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/concurrency/stream">Stream processing</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/concurrency/redis-lock">Redis Lock</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/concurrency/sharedcalls">SharedCalls</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Principle</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/principle/timing-wheel">TimingWheel</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Showcase</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/shorturl">Rapid development of microservices</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/zrpc">Enterprise RPC framework zRPC</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/mysql">Mysql</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/mapping">Mapping</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/datacenter">Data center</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/go-queue">Queue</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/go-zero-looklook">Develop a travel system using go-zero go-zero-looklook</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/metric">Microservice metrics monitoring based on prometheus</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Exchange</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/share/online-exchange">Online Communication on October 3,2020</a></li></ul></li></ul></div></div></div><main class="doc__main_VklL"><div class="padding-vert--lg container doc__item-wrapper_FIxd"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><header><h1 class="docTitle_-X99">Token Limit</h1></header><div class="markdown"><p>This section will introduce its basic usage through token limit (tokenlimit).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="usage"></a>Usage<a class="hash-link" href="#usage" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    burst   </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">100</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    rate    </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">100</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    seconds </span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">5</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">store </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> redis</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">NewRedis</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;localhost:6379&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;node&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">fmt</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Println</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">store</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Ping</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#6272a4">// New tokenLimiter</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">limiter </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> limit</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">NewTokenLimiter</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">rate</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> burst</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> store</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&quot;rate-test&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">timer </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> time</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">NewTimer</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">time</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Second </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain"> seconds</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">quit </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">make</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#ff79c6">chan</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">struct</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">defer</span><span class="token plain"> timer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Stop</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">go</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token operator" style="color:#ff79c6">&lt;-</span><span class="token plain">timer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">C</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#8be9fd">close</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">quit</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">var</span><span class="token plain"> allowed</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> denied </span><span class="token builtin" style="color:#bd93f9">int32</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">var</span><span class="token plain"> wait sync</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">WaitGroup</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> i </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">0</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> i </span><span class="token operator" style="color:#ff79c6">&lt;</span><span class="token plain"> runtime</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">NumCPU</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> i</span><span class="token operator" style="color:#ff79c6">++</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  wait</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Add</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#50fa7b">1</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">go</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#ff79c6">select</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">case</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&lt;-</span><span class="token plain">quit</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          wait</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Done</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">default</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> limiter</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Allow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            atomic</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">AddInt32</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">allowed</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">            atomic</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">AddInt32</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">denied</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#50fa7b">1</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">wait</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Wait</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">fmt</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Printf</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#f1fa8c">&quot;allowed: %d, denied: %d, qps: %d\n&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> allowed</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> denied</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">allowed</span><span class="token operator" style="color:#ff79c6">+</span><span class="token plain">denied</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token operator" style="color:#ff79c6">/</span><span class="token plain">seconds</span><span class="token punctuation" style="color:#f8f8f2">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="tokenlimit"></a>tokenlimit<a class="hash-link" href="#tokenlimit" title="Direct link to heading">#</a></h2><p>On the whole, the token bucket production logic is as follows:</p><ul><li>The average sending rate configured by the user is r, then a token is added to the bucket every 1/r second;</li><li>Assume that at most b tokens can be stored in the bucket. If the token bucket is full when the token arrives, then the token will be discarded;</li><li>When the traffic enters at the rate v, the token is taken from the bucket at the rate v, the traffic that gets the token passes, and the traffic that does not get the token does not pass, and the fuse logic is executed;</li></ul><p><code>go-zero</code> adopts the method of <code>lua script</code> under both types of current limiters, relying on redis to achieve distributed current limiting, and <code>lua script</code> can also achieve atomicity of token production and read operations.</p><p>Let&#x27;s take a look at several key attributes controlled by <code>lua script</code>:</p><table><thead><tr><th>argument</th><th>mean</th></tr></thead><tbody><tr><td>ARGV[1]</td><td>rate „ÄåHow many tokens are generated per second„Äç</td></tr><tr><td>ARGV[2]</td><td>burst „ÄåMaximum token bucket„Äç</td></tr><tr><td>ARGV[3]</td><td>now_time„ÄåCurrent timestamp„Äç</td></tr><tr><td>ARGV[4]</td><td>get token nums „ÄåThe number of tokens that the developer needs to obtain„Äç</td></tr><tr><td>KEYS[1]</td><td>Tokenkey representing the resource</td></tr><tr><td>KEYS[2]</td><td>The key that represents the refresh time</td></tr></tbody></table><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI lua"><div tabindex="0" class="prism-code language-lua codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">-- Return whether the expected token can be obtained alive</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">local rate = tonumber(ARGV[1])</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">local capacity = tonumber(ARGV[2])</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">local now = tonumber(ARGV[3])</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">local requested = tonumber(ARGV[4])</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">-- fill_timeÔºöHow long does it take to fill the token_bucket</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">local fill_time = capacity/rate</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">-- Round down the fill time</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">local ttl = math.floor(fill_time*2)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">-- Get the number of remaining tokens in the current token_bucket</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">-- If it is the first time to enter, set the number of token_bucket to the maximum value of the token bucket</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">local last_tokens = tonumber(redis.call(&quot;get&quot;, KEYS[1]))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">if last_tokens == nil then</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    last_tokens = capacity</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">end</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">-- The time when the token_bucket was last updated</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">local last_refreshed = tonumber(redis.call(&quot;get&quot;, KEYS[2]))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">if last_refreshed == nil then</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    last_refreshed = 0</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">end</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">local delta = math.max(0, now-last_refreshed)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">-- Calculate the number of new tokens based on the span between the current time and the last update time, and the rate of token production</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">-- If it exceeds max_burst, excess tokens produced will be discarded</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">local filled_tokens = math.min(capacity, last_tokens+(delta*rate))</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">local allowed = filled_tokens &gt;= requested</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">local new_tokens = filled_tokens</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">if allowed then</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    new_tokens = filled_tokens - requested</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">end</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">-- Update the new token number and update time</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">redis.call(&quot;setex&quot;, KEYS[1], ttl, new_tokens)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">redis.call(&quot;setex&quot;, KEYS[2], ttl, now)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">return allowed</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>It can be seen from the above that the <code>lua script</code>: only involves the operation of the token, ensuring that the token is produced and read reasonably.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="function-analysis"></a>Function analysis<a class="hash-link" href="#function-analysis" title="Direct link to heading">#</a></h2><p><img src="/assets/images/tokenlimit_func-98bcc4ce37675480a0062fef9e104906.png"></p><p>Seen from the above flow:</p><ol><li>There are multiple guarantee mechanisms to ensure that the current limit will be completed.</li><li>If the <code>redis limiter</code> fails, at least in the process <code>rate limiter</code> will cover it.</li><li>Retry the <code>redis limiter</code> mechanism to ensure that it runs as normally as possible.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>The <code>tokenlimit</code> current limiting scheme in <code>go-zero</code> is suitable for instantaneous traffic shocks, and the actual request scenario is not at a constant rate. The token bucket is quite pre-request, and when the real request arrives, it won&#x27;t be destroyed instantly. When the traffic hits a certain level, consumption will be carried out at a predetermined rate.</p><p>However, in the production of <code>token</code>, dynamic adjustment cannot be made according to the current flow situation, and it is not flexible enough, and further optimization can be carried out. In addition, you can refer to <a href="https://en.wikipedia.org/wiki/Token_bucket" target="_blank" rel="noopener noreferrer">Token bucket WIKI</a> which mentioned hierarchical token buckets, which are divided into different queues according to different traffic bandwidths.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="reference"></a>Reference<a class="hash-link" href="#reference" title="Direct link to heading">#</a></h2><ul><li><a href="https://github.com/zeromicro/go-zero/blob/master/core/limit/tokenlimit.go" target="_blank" rel="noopener noreferrer">go-zero tokenlimit</a></li><li><a href="https://github.com/go-redis/redis_rate" target="_blank" rel="noopener noreferrer">Redis Rate</a></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/zeromicro/portal/edit/main/docs/blog/governance/tokenlimit.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2022-05-04T14:01:08.000Z" class="lastUpdatedDate_nN9m">5/4/2022</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/blog/governance/periodlimit"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Period Limit</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/blog/cache/cache"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">DB caching mechanism ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#usage" class="table-of-contents__link">Usage</a></li><li><a href="#tokenlimit" class="table-of-contents__link">tokenlimit</a></li><li><a href="#function-analysis" class="table-of-contents__link">Function analysis</a></li><li><a href="#summary" class="table-of-contents__link">Summary</a></li><li><a href="#reference" class="table-of-contents__link">Reference</a></li></ul></div></div></div></div></main></div></div><footer class="footer_rm3y section_bQ6r"><div class="footer__inner_OWoZ section--inner_6-fB"><div class="footer__column_+a5z footer__column--left_4bpB"><div><img alt="go-zero logo" class="footer__logo_ayM4" height="27" src="/img/footer/go-zero.svg" title="go-zero" width="108"><img alt="stars" height="27" src="https://img.shields.io/github/stars/zeromicro/go-zero?style=social" class="footer__logo_ayM4"><img alt="forks" height="27" src="https://img.shields.io/github/forks/zeromicro/go-zero?style=social" class="footer__logo_ayM4"></div><p class="footer__tagline_b1u+">go-zero is a web and rpc framework that with lots of engineering practices builtin</p><a class="footer__github_okz3 button_f7Ff button--icon_q89D button--secondary_x3vq button--xsmall_fwzy" href="https://github.com/zeromicro/go-zero" rel="noopener noreferrer" target="_blank"><img alt="GitHub logo" height="22" src="/img/github.svg" title="GitHub" width="22">Star us on GitHub</a></div><div class="footer__column_+a5z footer__column--right_FGdI"><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">zeromicro</li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/zero-api" rel="noopener noreferrer" target="_blank">zero-api</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-queue" rel="noopener noreferrer" target="_blank">go-queue</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/awesome-zero" rel="noopener noreferrer" target="_blank">awesome-zero</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/zero-examples" rel="noopener noreferrer" target="_blank">zero-example</a></li></ul></div><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">Community</li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-zero" rel="noopener noreferrer" target="_blank">GitHub</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://discord.gg/4JQvC5A4Fe" rel="noopener noreferrer" target="_blank">Discord</a></li></ul></div><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">Links</li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://go-zero.dev/cn" rel="noopener noreferrer" target="_blank">Older Doc</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="/docs/blog/blog">Blog</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-zero/blob/master/ROADMAP.md" rel="noopener noreferrer" target="_blank">Roadmap</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://landscape.cncf.io/?selected=go-zero" rel="noopener noreferrer" target="_blank">CNCF</a></li></ul></div><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">Chat</li><li class="footer__item_K578"><img alt="discord" width="80" src="/img/footer/discord.png" class="footer__img_4fbU"></li></ul></div></div></div><div class="footer__bottom_rXtt"><p class="footer__copyright_9e29">Copyright ¬© 2022 zeromicro</p><ul><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/portal/blob/main/LICENSE">License</a></li></ul><p></p></div></footer></div>
<script src="/assets/js/main.ed0769b0.js" defer="defer"></script>
</body>
</html>