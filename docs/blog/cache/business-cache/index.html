<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="zeromicro">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="icon" href="https://doc.go-zero.dev/favicon.png">
<link rel="icon" href="https://doc.go-zero.dev/favicon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="https://doc.go-zero.dev/img/icons/apple-180x180.png" sizes="180x180">
<meta name="msapplication-config" content="/browserconfig.xml">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="go-zero Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="go-zero Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XZD0YKV3XQ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XZD0YKV3XQ",{anonymize_ip:!0})</script>
<link rel="manifest" href="//manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c"><title data-react-helmet="true">go-zero cache design for business-level caching | go-zero</title><meta data-react-helmet="true" property="og:image" content><meta data-react-helmet="true" name="twitter:image" content><meta data-react-helmet="true" name="twitter:description" content="go-zero æ˜¯ä¸€ä¸ªé›†æˆäº†å„ç§å·¥ç¨‹å®žè·µçš„ web å’Œ rpc æ¡†æž¶ã€‚é€šè¿‡å¼¹æ€§è®¾è®¡ä¿éšœäº†å¤§å¹¶å‘æœåŠ¡ç«¯çš„ç¨³å®šæ€§ï¼Œç»å—äº†å……åˆ†çš„å®žæˆ˜æ£€éªŒã€‚"><meta data-react-helmet="true" name="twitter:title" content="Introduction | go-zero"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;Introduction | go-zero&quot;"><meta data-react-helmet="true" property="og:title" content="go-zero cache design for business-level caching | go-zero"><meta data-react-helmet="true" name="description" content="In the previous article go-zero cache design of persistence layer cache introduced the db layer cache, in retrospect, the main design of the db layer cache can be summarized as follows"><meta data-react-helmet="true" property="og:description" content="In the previous article go-zero cache design of persistence layer cache introduced the db layer cache, in retrospect, the main design of the db layer cache can be summarized as follows"><link rel="stylesheet" href="/assets/css/styles.2224638b.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="">
<meta itemprop="description" content="go-zero æ˜¯ä¸€ä¸ªé›†æˆäº†å„ç§å·¥ç¨‹å®žè·µçš„ web å’Œ rpc æ¡†æž¶ã€‚é€šè¿‡å¼¹æ€§è®¾è®¡ä¿éšœäº†å¤§å¹¶å‘æœåŠ¡ç«¯çš„ç¨³å®šæ€§ï¼Œç»å—äº†å……åˆ†çš„å®žæˆ˜æ£€éªŒã€‚">
<meta itemprop="url" content="https://doc.go-zero.dev">
<meta itemprop="logo" content="https://doc.go-zero.dev/img/favicon.png">
<meta itemprop="sameAs" content="https://github.com/zeromicro">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar_wBc8 navbar--light navbar--fixed-top"><div class="navbar__inner inner_Y8Z6"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="brand_AtiA" href="/"><img alt="logo" height="30" src="/img/navbar/logo.svg" class="brand_logo_MqNk"><a class="navbar__brand brand_name_O39n">go-zero</a></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/prepare/prepare">Preparation</a></li><li><a class="dropdown__link" href="/docs/quick-start/quick-start">Getting Started</a></li><li><a class="dropdown__link" href="/docs/advance/advance">Guides</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" sidebarid="goctl">Goctl</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/goctl/installation">Installation</a></li><li><a class="dropdown__link" href="/docs/goctl/api">API Command</a></li><li><a class="dropdown__link" href="/docs/goctl/zrpc">RPC Command</a></li><li><a class="dropdown__link" href="/docs/goctl/model">Model Command</a></li><li><a class="dropdown__link" href="/docs/goctl/completion">Completion</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Tool</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/eco/plugins">Goctl Plugin</a></li><li><a class="dropdown__link" href="/docs/eco/editor">Editor Plugin</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/community/about-us">About us</a></li><li><a class="dropdown__link" href="/docs/community/showcase">Showcase</a></li><li><a class="dropdown__link" href="/docs/community/contribute">Contributing</a></li><li><a class="dropdown__link" href="/docs/community/contributor">Contributor</a></li><li><a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub</a></li><li><a href="https://discord.gg/4JQvC5A4Fe" target="_blank" rel="noopener noreferrer" class="dropdown__link">Discord</a></li></ul></div><a class="navbar__item navbar__link" sidebarid="blog" href="/docs/blog/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">More</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/resource-center/learning-resource">Resource Center</a></li><li><a href="https://space.bilibili.com/389552232/channel/seriesdetail?sid=2122723" target="_blank" rel="noopener noreferrer" class="dropdown__link">Video Tutorial</a></li><li><a href="https://github.com/zeromicro/go-zero/blob/master/ROADMAP.md" target="_blank" rel="noopener noreferrer" class="dropdown__link">Development Roadmap</a></li><li><a class="dropdown__link" href="/docs/design/design">Design Docs</a></li><li><a class="dropdown__link" href="/docs/faq/troubleshooting">FAQ</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="searchWrapper_f8aU"><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_CDc6"><kbd class="searchHint_2RRg">ctrl</kbd><kbd class="searchHint_2RRg">K</kbd></div></div></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/docs/blog/cache/business-cache" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/cn/docs/blog/cache/business-cache" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">ä¸­æ–‡ç®€ä½“</a></li></ul></div><a href="https://github.com/zeromicro/go-zero" class="navbar__items navbar__items--right"><img alt="forks" height="30" src="/img/navbar/github.svg" class="star__fork_dBtt"><div class="star_fork_layout_ROo5"><img alt="stars" height="20" src="https://img.shields.io/github/stars/zeromicro/go-zero?style=social" class="star__fork_dBtt"><img alt="forks" height="20" src="https://img.shields.io/github/forks/zeromicro/go-zero?style=social" class="star__fork_dBtt"></div></a><div class="react-toggle themeToggleInHeading_b3Mq react-toggle--checked react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV" style="margin-left:2px">ðŸŒ™</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV" style="margin-left:1px">â˜€</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_AtiA" href="/">go-zero</a><div class="react-toggle themeToggleInSidebar_qGRI react-toggle--checked react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV" style="margin-left:2px">ðŸŒ™</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV" style="margin-left:1px">â˜€</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist"><span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>Languages</span></span></a><ul class="menu__list"><li class="menu__list-item"><a href="/docs/blog/cache/business-cache" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li class="menu__list-item"><a href="/cn/docs/blog/cache/business-cache" target="_self" rel="noopener noreferrer" class="menu__link" style="text-transform:capitalize">ä¸­æ–‡ç®€ä½“</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Docs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/prepare/prepare">Preparation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/quick-start/quick-start">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/advance/advance">Guides</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist" sidebarid="goctl">Goctl</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/goctl/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/goctl/api">API Command</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/goctl/zrpc">RPC Command</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/goctl/model">Model Command</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/goctl/completion">Completion</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Tool</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/eco/plugins">Goctl Plugin</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/eco/editor">Editor Plugin</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">Community</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/community/about-us">About us</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/community/showcase">Showcase</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/community/contribute">Contributing</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/community/contributor">Contributor</a></li><li class="menu__list-item"><a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://discord.gg/4JQvC5A4Fe" target="_blank" rel="noopener noreferrer" class="menu__link">Discord</a></li></ul></li><li class="menu__list-item"><a class="menu__link" sidebarid="blog" href="/docs/blog/blog">Blog</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">More</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/resource-center/learning-resource">Resource Center</a></li><li class="menu__list-item"><a href="https://space.bilibili.com/389552232/channel/seriesdetail?sid=2122723" target="_blank" rel="noopener noreferrer" class="menu__link">Video Tutorial</a></li><li class="menu__list-item"><a href="https://github.com/zeromicro/go-zero/blob/master/ROADMAP.md" target="_blank" rel="noopener noreferrer" class="menu__link">Development Roadmap</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/design/design">Design Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/faq/troubleshooting">FAQ</a></li></ul></li></ul></div></div></div></nav><div class="wrapper_DIJ0"><div class="doc_D+rh"><div class="doc__sidebar_gVFN" role="complementary"><div class="sidebar_LIo8"><div class="menu menu--responsive thin-scrollbar menu_oAhv"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_nrF-" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" href="/docs/blog/blog">Blog</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Governance</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/governance/bloom">Bloom Filter</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/governance/breaker-algorithms">Fusing Principle and Implementation</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/governance/loadshedding">Load Shedding</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/governance/periodlimit">Period Limit</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/governance/tokenlimit">Token Limit</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u menu__link--sublist menu__link--active" href="#!">Cache</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/docs/blog/cache/cache">DB caching mechanism</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/docs/blog/cache/redis-cache">go-zero cache design for persistence layer cache</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menuLink_Zq3u menu__link--active active" tabindex="0" href="/docs/blog/cache/business-cache">go-zero cache design for business-level caching</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/docs/blog/cache/collection">Caching via collection</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Components</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/tool/executors">Executors</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/tool/keywords">Efficient keyword replacement and sensitive word filtering tool</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/tool/logx">logx</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Concurrency</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/concurrency/fx">Fx</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/concurrency/mapreduce">Mapreduce</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/concurrency/stream">Stream processing</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/concurrency/redis-lock">Redis Lock</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/concurrency/sharedcalls">SharedCalls</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Principle</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/principle/timing-wheel">TimingWheel</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Showcase</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/shorturl">Rapid development of microservices</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/zrpc">Enterprise RPC framework zRPC</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/mysql">Mysql</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/mapping">Mapping</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/datacenter">Data center</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/go-queue">Queue</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/go-zero-looklook">Develop a travel system using go-zero go-zero-looklook</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/showcase/metric">Microservice metrics monitoring based on prometheus</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">Exchange</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/docs/blog/share/online-exchange">Online Communication on October 3,2020</a></li></ul></li></ul></div></div></div><main class="doc__main_VklL"><div class="padding-vert--lg container doc__item-wrapper_FIxd"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><header><h1 class="docTitle_-X99">go-zero cache design for business-level caching</h1></header><div class="markdown"><p>In the previous article <a href="/docs/blog/cache/redis-cache">go-zero cache design of persistence layer cache</a> introduced the db layer cache, in retrospect, the main design of the db layer cache can be summarized as follows</p><ul><li>The cache is only deleted and not updated</li><li>Only one row record is always stored, i.e. the primary key corresponds to the row record</li><li>Unique indexes only cache primary key values, not directly cache row records (refer to mysql indexing ideas)</li><li>Anti-cache-pass-through design, default one minute</li><li>No caching of multiple row records</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="preface"></a>Preface<a class="hash-link" href="#preface" title="Direct link to heading">#</a></h2><p>In large business systems, by adding cache to the persistence layer, it is believed that the cache can help relieve a lot of access pressure on the persistence layer for most single-row queries, but in actual business, data reading is not just for single-row records.
In addition, for high concurrency scenarios such as spike systems and class selection systems, it is not practical to rely solely on caching in the persistence layer.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="examples-of-applicable-scenarios"></a>Examples of applicable scenarios<a class="hash-link" href="#examples-of-applicable-scenarios" title="Direct link to heading">#</a></h2><ul><li>Course selection system</li><li>Content social system</li><li>Spike ...</li></ul><p>In these systems, we can add another layer of cache in the business layer to store key information in the system, such as student selection information and remaining places in the course in the course selection system, and content information between a certain period of time in the content social system.</p><p>Next, let&#x27;s take a content social system as an example.</p><p>In the content social system, we usually query a list of content first, and then click on a piece of content to view the details.</p><p>Before adding biz cache, the query flow chart of content information should be as follows</p><p><img alt="redis-cache-05" src="/assets/images/redis-cache-05-f1847d60569f085c07e97d9d3e7482e4.png"></p><p>As we know from the diagram and the previous article <a href="/docs/blog/cache/redis-cache">go-zero cache design of persistence layer cache</a>, there is no way to rely on the cache for accessing the content list.
If we add a layer of cache at the business layer to store key information (or even complete information) in the list, then access to multiple rows of records is not a problem, and that&#x27;s what biz redis is going to do. Next, let&#x27;s look at the design solution, assuming that a single row of records in the content system contains the following fields</p><table><thead><tr><th>Field</th><th>Type</th><th>Desc</th></tr></thead><tbody><tr><td>id</td><td>string</td><td>id</td></tr><tr><td>title</td><td>string</td><td>title</td></tr><tr><td>content</td><td>string</td><td>content</td></tr><tr><td>createTime</td><td>time.Time</td><td>create time</td></tr></tbody></table><p>Our goal is to get a list of content, and try to avoid the content list to go db cause access pressure, first we use redis sort set data structure to store, the amount of information in the fields need to be stored, there are two redis storage options.</p><ul><li>cache local information</li></ul><p><img alt="biz-redis-02" src="/assets/images/biz-redis-02-c74e333a1fd8a3af9c5f12314a9fb1cd.svg">
for its key segment information (such as: id, etc.) in accordance with certain rules of compression, and storage, score we use <code>createTime</code> millisecond value (time value equal here is not discussed), the benefits of this storage scheme is to save redis storage space.
That on the other hand, the disadvantage is the need for a list of detailed content of the second check (but this check is to use the persistence layer of the line record cache)</p><ul><li>Cache full information</li></ul><p><img alt="biz-redis-01" src="/assets/images/biz-redis-01-0127f70ec68f0f517000377799a7694f.svg">
All the content published in accordance with certain rules of compression are stored, the same score we still use <code>createTime</code> millisecond value, the benefits of this storage scheme is the business of adding, deleting, checking, changing all go redis, and db layer at this time
On the other hand, the disadvantage is also obvious, the need for storage space, configuration requirements are higher, the cost will also increase.</p><p>Exampleï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI golang"><div tabindex="0" class="prism-code language-golang codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">type Content struct {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Id         string    `json:&quot;id&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Title      string    `json:&quot;title&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Content    string    `json:&quot;content&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    CreateTime time.Time `json:&quot;create_time&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">const bizContentCacheKey = `biz#content#cache`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">func AddContent(r redis.Redis, c *Content) error {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    v := compress(c)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    _, err := r.Zadd(bizContentCacheKey, c.CreateTime.UnixNano()/1e6, v)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    return err</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">func DelContent(r redis.Redis, c *Content) error {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    v := compress(c)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    _, err := r.Zrem(bizContentCacheKey, v)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    return err</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">func compress(c *Content) string {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    // todo: do it yourself</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    var ret string</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    return ret</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">func unCompress(v string) *Content {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    // todo: do it yourself</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    var ret Content</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    return &amp;ret</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">func ListByRangeTime(r redis.Redis, start, end time.Time) ([]*Content, error) {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    kvs, err := r.ZrangebyscoreWithScores(bizContentCacheKey, start.UnixNano()/1e6, end.UnixNano()/1e6)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    if err != nil {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        return nil, err</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    var list []*Content</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    for _, kv := range kvs {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        data:=unCompress(kv.Key)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        list = append(list, data)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    return list, nil</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB">Copy</button></div></div><p>In the above example, redis is not set to expire, we will add, delete, change and check operations are synchronized to redis, we think the content social system list access request is relatively high case to do such a scheme design.
In addition, there are some data access, not want to content design system so frequently access, may be a certain period of time to access the sudden increase, after which may be a long time to visit again, so that the interval
Or will not visit again, face this scenario, if I and how to consider the design of the cache? In go-zero content practice, there are two options to solve this problem.</p><ul><li>Adding memory cache: The memory cache is used to store the data that may be accessed unexpectedly at present.
Another option is to use the <a href="https://github.com/zeromicro/go-zero/blob/master/core/collection/cache.go" target="_blank" rel="noopener noreferrer">Cache</a> in the go-zero library, which is specifically
for memory management.</li><li>The other solution is to use in the go-zero library, which is dedicated to memory management.</li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h1><p>The above two scenarios can include most of the multi-line record cache, for multi-line record query volume is not large scenario, for the time being, there is no need to directly put biz redis in, you can first try to let db to take on, developers can be based on persistence layer monitoring and service
The developer can measure the need to introduce biz based on persistence layer monitoring and service monitoring.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/zeromicro/portal/edit/main/docs/blog/cache/business-cache.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2022-05-01T07:55:16.000Z" class="lastUpdatedDate_nN9m">5/1/2022</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/blog/cache/redis-cache"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« go-zero cache design for persistence layer cache</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/blog/cache/collection"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Caching via collection Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#preface" class="table-of-contents__link">Preface</a></li><li><a href="#examples-of-applicable-scenarios" class="table-of-contents__link">Examples of applicable scenarios</a></li></ul></div></div></div></div></main></div></div><footer class="footer_rm3y section_bQ6r"><div class="footer__inner_OWoZ section--inner_6-fB"><div class="footer__column_+a5z footer__column--left_4bpB"><div><img alt="go-zero logo" class="footer__logo_ayM4" height="27" src="/img/footer/go-zero.svg" title="go-zero" width="108"><img alt="stars" height="27" src="https://img.shields.io/github/stars/zeromicro/go-zero?style=social" class="footer__logo_ayM4"><img alt="forks" height="27" src="https://img.shields.io/github/forks/zeromicro/go-zero?style=social" class="footer__logo_ayM4"></div><p class="footer__tagline_b1u+">go-zero is a web and rpc framework that with lots of engineering practices builtin</p><a class="footer__github_okz3 button_f7Ff button--icon_q89D button--secondary_x3vq button--xsmall_fwzy" href="https://github.com/zeromicro/go-zero" rel="noopener noreferrer" target="_blank"><img alt="GitHub logo" height="22" src="/img/github.svg" title="GitHub" width="22">Star us on GitHub</a></div><div class="footer__column_+a5z footer__column--right_FGdI"><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">zeromicro</li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/zero-api" rel="noopener noreferrer" target="_blank">zero-api</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-queue" rel="noopener noreferrer" target="_blank">go-queue</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/awesome-zero" rel="noopener noreferrer" target="_blank">awesome-zero</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/zero-examples" rel="noopener noreferrer" target="_blank">zero-example</a></li></ul></div><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">Community</li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-zero" rel="noopener noreferrer" target="_blank">GitHub</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://discord.gg/4JQvC5A4Fe" rel="noopener noreferrer" target="_blank">Discord</a></li></ul></div><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">Links</li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://go-zero.dev/cn" rel="noopener noreferrer" target="_blank">Older Doc</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="/blog/blog">Blog</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-zero/blob/master/ROADMAP.md" rel="noopener noreferrer" target="_blank">Roadmap</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://landscape.cncf.io/?selected=go-zero" rel="noopener noreferrer" target="_blank">CNCF</a></li></ul></div><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">Chat</li><li class="footer__item_K578"><img alt="discord" width="80" src="/img/footer/discord.png" class="footer__img_4fbU"></li></ul></div></div></div><div class="footer__bottom_rXtt"><p class="footer__copyright_9e29">Copyright Â© 2022 zeromicro</p><ul><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/portal/blob/main/LICENSE">License</a></li></ul><p></p></div></footer></div>
<script src="/assets/js/main.7568d8b8.js" defer="defer"></script>
</body>
</html>