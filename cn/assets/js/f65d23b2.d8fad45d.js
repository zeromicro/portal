"use strict";(self.webpackChunkgo_zero=self.webpackChunkgo_zero||[]).push([[5825],{3905:function(e,t,n){n.d(t,{Zo:function(){return s},kt:function(){return u}});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var p=a.createContext({}),c=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},s=function(e){var t=c(e.components);return a.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},g=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,p=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),g=c(n),u=l,d=g["".concat(p,".").concat(u)]||g[u]||m[u]||r;return n?a.createElement(d,o(o({ref:t},s),{},{components:n})):a.createElement(d,o({ref:t},s))}));function u(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,o=new Array(r);o[0]=g;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i.mdxType="string"==typeof e?e:l,o[1]=i;for(var c=2;c<r;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}g.displayName="MDXCreateElement"},7507:function(e,t,n){n.r(t),n.d(t,{default:function(){return m},frontMatter:function(){return i},metadata:function(){return p},toc:function(){return c}});var a=n(7462),l=n(3366),r=(n(7294),n(3905)),o=["components"],i={},p={unversionedId:"blog/share/goctl-share-part-two",id:"blog/share/goctl-share-part-two",isDocsHomePage:!1,title:"goctl \u6548\u80fd\u5de5\u5177\u6df1\u5ea6\u89e3\u6790\uff08\u4e8c\uff09",description:"\u300a goctl \u6548\u80fd\u5de5\u5177\u6df1\u5ea6\u89e3\u6790\uff08\u4e00\uff09\u300b",source:"@site/i18n/cn/docusaurus-plugin-content-docs/current/blog/share/goctl-share-part-two.md",sourceDirName:"blog/share",slug:"/blog/share/goctl-share-part-two",permalink:"/cn/docs/blog/share/goctl-share-part-two",editUrl:"https://github.com/zeromicro/portal/edit/main/i18n/cn/docusaurus-plugin-content-docs/current/blog/share/goctl-share-part-two.md",version:"current",lastUpdatedAt:1673582998,formattedLastUpdatedAt:"1/13/2023",frontMatter:{},sidebar:"blog",previous:{title:"goctl \u6548\u80fd\u5de5\u5177\u6df1\u5ea6\u89e3\u6790\uff08\u4e00\uff09",permalink:"/cn/docs/blog/share/goctl-share-part-one"}},c=[{value:"\u56db goctl \u6e90\u7801\u89e3\u8bfb",id:"\u56db-goctl-\u6e90\u7801\u89e3\u8bfb",children:[{value:"goctl api",id:"goctl-api",children:[]},{value:"goctl rpc",id:"goctl-rpc",children:[]},{value:"goctl model",id:"goctl-model",children:[]},{value:"goctl migrate",id:"goctl-migrate",children:[]}]},{value:"\u4e94\u3001\u811a\u624b\u67b6\u5f00\u53d1\u6d41\u7a0b",id:"\u4e94\u811a\u624b\u67b6\u5f00\u53d1\u6d41\u7a0b",children:[{value:"1. \u5de5\u5177\u9009\u62e9(CLI)",id:"1-\u5de5\u5177\u9009\u62e9cli",children:[]},{value:"2. \u5b9a\u4e49FlagSet (Command)",id:"2-\u5b9a\u4e49flagset-command",children:[]},{value:"3. \u9886\u57df\u7279\u5b9a\u8bed\u8a00\u9009\u62e9\uff08DSL, optional\uff09",id:"3-\u9886\u57df\u7279\u5b9a\u8bed\u8a00\u9009\u62e9dsl-optional",children:[]},{value:"4. \u8bed\u6cd5\u89e3\u6790(Parser)",id:"4-\u8bed\u6cd5\u89e3\u6790parser",children:[]},{value:"5. \u6570\u636e\u9a71\u52a8(Render)",id:"5-\u6570\u636e\u9a71\u52a8render",children:[]},{value:"6. \u4ee3\u7801\u683c\u68c0\u67e5(Inspections)",id:"6-\u4ee3\u7801\u683c\u68c0\u67e5inspections",children:[]}]},{value:"\u6269\u5c55\u9605\u8bfb",id:"\u6269\u5c55\u9605\u8bfb",children:[]}],s={toc:c};function m(e){var t=e.components,i=(0,l.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},s,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"goctl-share-part-one"},"\u300a goctl \u6548\u80fd\u5de5\u5177\u6df1\u5ea6\u89e3\u6790\uff08\u4e00\uff09\u300b")),(0,r.kt)("h2",{id:"\u56db-goctl-\u6e90\u7801\u89e3\u8bfb"},"\u56db goctl \u6e90\u7801\u89e3\u8bfb"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u7ed3\u6784\u56fe")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"\u7ed3\u6784\u56fe",src:n(7810).Z})),(0,r.kt)("h3",{id:"goctl-api"},"goctl api"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u6d41\u7a0b\u56fe"),"\n",(0,r.kt)("img",{alt:"api",src:n(2e3).Z})),(0,r.kt)("h3",{id:"goctl-rpc"},"goctl rpc"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u6d41\u7a0b\u56fe"),"\n",(0,r.kt)("img",{alt:"api",src:n(6165).Z})),(0,r.kt)("h3",{id:"goctl-model"},"goctl model"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u6d41\u7a0b\u56fe"),"\n",(0,r.kt)("img",{alt:"api",src:n(6777).Z})),(0,r.kt)("h3",{id:"goctl-migrate"},"goctl migrate"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u6d41\u7a0b\u56fe"),"\n",(0,r.kt)("img",{alt:"api",src:n(1619).Z})),(0,r.kt)("h2",{id:"\u4e94\u811a\u624b\u67b6\u5f00\u53d1\u6d41\u7a0b"},"\u4e94\u3001\u811a\u624b\u67b6\u5f00\u53d1\u6d41\u7a0b"),(0,r.kt)("p",null,"\u811a\u624b\u67b6\u5728\u6211\u4eec\u7684\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u505a\u5f88\u591a\u4e8b\u60c5\uff0c\u6bd4\u5982\u4f9d\u8d56\u5b89\u88c5\u3001\u4ee3\u7801\u751f\u6210\u3001\u670d\u52a1\u90e8\u7f72\u6587\u4ef6\u751f\u6210\u7b49,\u5982\u679c\u6211\u4eec\u8981\u5b9e\u73b0\u4e00\u4e2a\u7c7b\u4f3c goctl \u7684\u811a\u624b\u67b6\u9700\u8981\u505a\u54ea\u4e9b\u51c6\u5907\u5de5\u4f5c\u6216\u8005\u6280\u80fd\u50a8\u5907\u5462\uff1f"),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),'"\u77e5\u8bc6\u70b9\u50a8\u5907"')),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("ol",{parentName:"div"},(0,r.kt)("li",{parentName:"ol"},"Golang \u6a21\u677f"),(0,r.kt)("li",{parentName:"ol"},"\u6b63\u5219\u8868\u8fbe\u5f0f"),(0,r.kt)("li",{parentName:"ol"},"BNF \u8303\u5f0f"),(0,r.kt)("li",{parentName:"ol"},"ANTLR")))),(0,r.kt)("h3",{id:"1-\u5de5\u5177\u9009\u62e9cli"},"1. \u5de5\u5177\u9009\u62e9(CLI)"),(0,r.kt)("p",null,"urfave/cli \u4e0e cobra \u5bf9\u6bd4(\u4ee5\u4e0b\u6570\u636e\u622a\u6b62\u65f6\u95f4\u4e3a2022\u5e745\u670825\u65e5 18\u70b900\u5206)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ github-compare urfave/cli spf13/cobra\n")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"api",src:n(4645).Z})),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"right"},"urfave/cli"),(0,r.kt)("th",{parentName:"tr",align:null}),(0,r.kt)("th",{parentName:"tr",align:"left"},"spf13/cobra"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},"aws\u3001kubernetes\u3001go-micro\u3001github\u3001microsoft"),(0,r.kt)("td",{parentName:"tr",align:null},"\u77e5\u540d\u7528\u6237\uff08\u62e9\u81ea Uesd by\uff09"),(0,r.kt)("td",{parentName:"tr",align:"left"},"etcd\u3001GoogleCloud\u3001kubernetes\u3001apache\u3001zeromicro\u3001tidb\u3001Github CLI\u3001Hugo")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"right"},"\u8d34\u7d27 golang \u539f\u751f"),(0,r.kt)("td",{parentName:"tr",align:null},"\u7279\u70b9"),(0,r.kt)("td",{parentName:"tr",align:"left"},"POSIX \u6807\u51c6\uff08\u8d34\u5408 UNIX \u8bbe\u8ba1\uff09\uff0c\u652f\u6301\u5168\u5c40 flag")))),(0,r.kt)("p",null,"\u4ece\u4ee5\u4e0a\u5404\u5bf9\u6bd4\u6307\u6807\u6765\u770b\uff0ccobra \u662f\u6211\u66f4\u503e\u5411\u7684\u9009\u62e9\u3002"),(0,r.kt)("h3",{id:"2-\u5b9a\u4e49flagset-command"},"2. \u5b9a\u4e49FlagSet (Command)"),(0,r.kt)("p",null,"\u6839\u636e\u81ea\u5df1\u9700\u8981\u5b9e\u73b0\u7684\u529f\u80fd\u6dfb\u52a0\u5b50\u6307\u4ee4\u548c flag\u3002"),(0,r.kt)("h3",{id:"3-\u9886\u57df\u7279\u5b9a\u8bed\u8a00\u9009\u62e9dsl-optional"},"3. \u9886\u57df\u7279\u5b9a\u8bed\u8a00\u9009\u62e9\uff08DSL, optional\uff09"),(0,r.kt)("p",null,"\u9886\u57df\u7279\u5b9a\u8bed\u8a00\u7684\u9009\u62e9\uff0c\u50cf goctl \u4e2d\u7684 api \u548c rpc \u529f\u80fd\u4e00\u6837\uff0c\u5982\u679c\u4f60\u7684\u811a\u624b\u67b6\u9700\u8981\u9009\u62e9\u4e00\u5957 DSL\uff0c\u90a3\u4e48 DSL \u7684\u9009\u62e9\u4e5f\u662f\u5fc5\u987b\u8981\u8003\u8651\u7684\uff0c\u81ea\u7814\u8fd8\u662f\u9009\u62e9\u6210\u719f\u7684 DSL\uff0c\u8fd9\u90fd\u662f\u8981\u7efc\u5408\u8003\u8651\u7684\u3002"),(0,r.kt)("h4",{id:"31-\u81ea\u7814-dsl"},"3.1 \u81ea\u7814 DSL"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u8c03\u7814\u4e3b\u6d41\u8bed\u8a00\u7684 DSL \u89c4\u8303\uff0c\u5982 Golang\u3001yaml"),(0,r.kt)("li",{parentName:"ol"},"\u7f16\u5199 DSL \u89c4\u8303\uff08Spec\uff09\uff0c\u4e86\u89e3 BNF\u3001ABNF\u3001EBNF"),(0,r.kt)("li",{parentName:"ol"},"\u9009\u62e9\u5408\u9002\u7684\u8bed\u6cd5\u89e3\u6790\u5668\uff0c\u8fd9\u91cc\u6211\u4eec\u4e0d\u9700\u8981\u5bf9\u7f16\u8bd1\u539f\u7406\u6709\u8db3\u591f\u7684\u77e5\u8bc6\uff0c\u6211\u4eec\u7684 DSL \u4e0d\u662f\u7f16\u7a0b\u7ea7\u522b\u7684\uff0c\u4e0d\u7528\u8003\u8651\u592a\u591a\uff0c\u56e0\u6b64\u76ee\u524d\u5e02\u9762\u4e0a\u4e00\u4e9b\u5e38\u89c1\u7684\u89e3\u6790\u5668\u5c31\u53ef\u4ee5\u6ee1\u8db3\uff0c\u6211\u4eec\u53ea\u9700\u8981\u9605\u8bfb\u5176\u6587\u6863\u505a\u4e00\u4e9b\u4e86\u89e3\u5373\u53ef\u4e0a\u624b\u5b9e\u73b0\u7b80\u5355\u7684 DSL \u89e3\u6790\uff0c\u4e0b\u6587\u6211\u5c06\u8d34\u4e00\u4e9b\u76ee\u524d\u5b58\u5728\u7684\u4e00\u4e9b\u89e3\u6790\u5668\u6216\u8005\u6848\u4f8b\u53c2\u8003\uff1a")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"\u5de5\u5177\u540d\u79f0"),(0,r.kt)("th",{parentName:"tr",align:null},"\u5b9e\u73b0\u8bed\u6cd5"),(0,r.kt)("th",{parentName:"tr",align:null},"\u4f18\u70b9"),(0,r.kt)("th",{parentName:"tr",align:null},"\u4e0d\u8db3"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Golang Parser"),(0,r.kt)("td",{parentName:"tr",align:null},"Golang"),(0,r.kt)("td",{parentName:"tr",align:null},"\u517c\u5bb9\u3001\u6613\u7ef4\u62a4\u3001\u5185\u5b58\u4f7f\u7528\u8f83\u4f4e\u3001\u8d34\u8fd1 golang"),(0,r.kt)("td",{parentName:"tr",align:null},"\u4e0a\u624b\u6210\u672c\u9ad8\uff0c\u81ea\u5df1\u4ece0\u5b9e\u73b0\u8bcd\u6cd5\u5206\u6790\uff0c\u8bed\u6cd5\u89e3\u6790\u5230 AST \u7684\u6240\u6709\u8fc7\u7a0b")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"ANTLR\uff08g4\uff09"),(0,r.kt)("td",{parentName:"tr",align:null},"Java"),(0,r.kt)("td",{parentName:"tr",align:null},"\u4e0a\u624b\u95e8\u69db\u4f4e\u3001Intellij\u63d0\u4f9b\u4e86\u4ee3\u7801\u751f\u6210\u63d2\u4ef6\u3001\u5b8c\u6574\u7684\u6587\u6863\u4ecb\u7ecd"),(0,r.kt)("td",{parentName:"tr",align:null},"\u5185\u5b58\u8981\u6c42\u9ad8\uff0c\u6709\u4e9b\u7cfb\u7edf\u67b6\u6784\u652f\u6301\u4e0d\u53cb\u597d\uff0c\u5982386")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"YACC"),(0,r.kt)("td",{parentName:"tr",align:null},"C"),(0,r.kt)("td",{parentName:"tr",align:null},"-"),(0,r.kt)("td",{parentName:"tr",align:null},"\u6682\u4e0d\u652f\u6301 golang")))),(0,r.kt)("h5",{id:"311-antlr-\u4f7f\u7528\u793a\u4f8b"},"3.1.1 ANTLR \u4f7f\u7528\u793a\u4f8b"),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),'"\u529f\u80fd\u76ee\u6807"')),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},"\u5b9e\u73b0\u591a\u884c\u666e\u901a\u7684 Hello ${msg} \u8bed\u6cd5"),(0,r.kt)("li",{parentName:"ul"},"\u652f\u6301\u5355\u884c\u6ce8\u91ca\n\u6280\u80fd\u8981\u70b9"),(0,r.kt)("li",{parentName:"ul"},"\u6b63\u5219\u8868\u8fbe\u5f0f"),(0,r.kt)("li",{parentName:"ul"},"ANTLR \u4f7f\u7528")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"// \u8fd9\u662f\u4e00\u4e2a\u7b80\u5355\u7684 DSL \u63cf\u8ff0\u6587\u4ef6\nHello World\nHello gozero\nHello keson\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"3.1.1.1 \u73af\u5883\u51c6\u5907")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Java"),(0,r.kt)("li",{parentName:"ul"},"Intellij\u3001Goland"),(0,r.kt)("li",{parentName:"ul"},"\u63d2\u4ef6\u5b89\u88c5\uff1aANTLR v4\u3001Grammar-Kit")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"3.1.1.2 \u7f16\u5199\u8bed\u6cd5\u6587\u4ef6 Hello.g4")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-g4"},"grammar Hello;\n\nhello: spec*;\nspec: ID ID;\n\nID:         Letter*;\nWS: [ \\t\\r\\n\\u000C]+ -> channel(HIDDEN);\nLINE_COMMENT:   '//' ~[\\r\\n]* -> channel(HIDDEN);\n\nERRCHAR\n   :  .  -> channel(HIDDEN)\n   ;\n   \nfragment Letter\n    : [a-zA-Z$_] // these are the \"java letters\" below 0x7F\n    | ~[\\u0000-\\u007F\\uD800-\\uDBFF] // covers all characters above 0x7F which are not a surrogate\n    | [\\uD800-\\uDBFF] [\\uDC00-\\uDFFF] // covers UTF-16 surrogate pairs encodings for U+10000 to U+10FFFF\n    ;\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"3.1.1.3 ANTLR \u9884\u89c8")),(0,r.kt)("p",null,"\u901a\u8fc7 intellij \u4e2d\u7684 ANTLR v4 \u63d2\u4ef6\u5bf9 g4 \u6587\u4ef6\u4e2d\u7684\u8bed\u6cd5\u8fdb\u884c\u9884\u89c8\uff0c\u67e5\u770b\u662f\u5426\u7b26\u5408\u9884\u671f"),(0,r.kt)("p",null,"\u64cd\u4f5c\u8def\u5f84:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5728 Hello.g4 \u6587\u4ef6\u4e2d\u9009\u62e9\u540d\u79f0\u4e3a hello \u6839\u8bed\u6cd5\u8282\u70b9"),(0,r.kt)("li",{parentName:"ol"},"\u53f3\u952e\u627e\u5230\u9760\u8fd1\u5e95\u90e8\u7684 Test rule hello")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Test rule",src:n(4906).Z})),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"\u8f93\u5165 DSL \u5185\u5bb9\u5e76\u67e5\u770b\u5bf9\u5e94\u7684\u8bed\u6cd5\u6811")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"// \u8fd9\u662f\u4e00\u4e2a\u7b80\u5355\u7684 DSL \u63cf\u8ff0\u6587\u4ef6\nHello World\nHello gozero\nHello keson\n")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Tree",src:n(7392).Z})),(0,r.kt)("p",null,"\u6839\u636e\u4e0a\u56fe\u53ef\u4ee5\u770b\u51fa\uff0c\u6211\u4eec\u8f93\u5165\u7684\u6d4b\u8bd5\u5185\u5bb9\u548c\u6211\u4eec\u5b9a\u4e49\u7684\u8bed\u6cd5\u6587\u4ef6 Hello.g4 \u662f\u7b26\u5408\u7684\u3002\n\u7531\u4e0a\u6587\u8bed\u6cd5\u6587\u4ef6\u53ef\u77e5\uff0c\u6211\u4eec\u4ec5\u652f\u6301\u5355\u884c\u6ce8\u91ca\u548c 0\u5230n \u4e2a ID ID \u7ec4\u6210\u7684\u5185\u5bb9\uff0c\u5e76\u4e14\u5ffd\u7565\u4e86\u7a7a\u767d\u7b26\uff0c\u5982\u679c\u6211\u4eec\u6d4b\u8bd5\u5185\u5bb9\u8f93\u5165\u4e3a\u4e00\u4e0b\u5185\u5bb9\u5219\u4f1a\u53d1\u73b0\u4e0d\u5339\u914d\uff0c\u4e14 Goland \u4f1a\u7ed9\u4f60\u4e0d\u7b26\u5408\u9884\u671f\u7684\u539f\u56e0"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"Hello 123\n")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Tree",src:n(9495).Z})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"3.1.1.4 \u751f\u6210 Go \u4ee3\u7801")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u914d\u7f6e\u751f\u6210\u53c2\u6570"),(0,r.kt)("p",{parentName:"li"},"\u64cd\u4f5c\u8def\u5f84: \u5728 Hello.g4 \u6587\u4ef6\u7684\u7f16\u8f91\u533a\u53f3\u952e\uff0c\u9009\u62e9 Configure ANTLR...\uff0c\u8f93\u51fa\u8def\u5f84\u9009\u62e9 Hello.g4 \u6240\u5728\u76ee\u5f55\u5373\u53ef\uff0c\u5176\u4ed6\u7684\u6309\u7167\u4e0b\u56fe\u914d\u7f6e\u3002"))),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Tree",src:n(9591).Z})),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u751f\u6210 Golang \u89e3\u6790\u4ee3\u7801"),(0,r.kt)("p",{parentName:"li"},"\u64cd\u4f5c\u8def\u5f84\uff1a\u5728 Hello.g4 \u6587\u4ef6\u7684\u7f16\u8f91\u533a\u53f3\u952e\uff0c\u9009\u62e9 Generate ANLTR Recognizer\u5373\u53ef\uff0c\u751f\u6210\u540e\u4f1a\u5728 Hello.g4 \u76ee\u5f55\u4e0b\u591a\u4e00\u4e2a gen \u6587\u4ef6\u5939"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ tree\n.\n\u251c\u2500\u2500 Hello.g4\n\u2514\u2500\u2500 gen\n    \u251c\u2500\u2500 Hello.interp\n    \u251c\u2500\u2500 Hello.tokens\n    \u251c\u2500\u2500 HelloLexer.interp\n    \u251c\u2500\u2500 HelloLexer.tokens\n    \u251c\u2500\u2500 hello_base_visitor.go\n    \u251c\u2500\u2500 hello_lexer.go\n    \u251c\u2500\u2500 hello_parser.go\n    \u2514\u2500\u2500 hello_visitor.go\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"3.1.1.5 \u7ed3\u6784\u4f53\u8f6c\u6362\u4e0e\u8bed\u4e49\u5206\u6790")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5728 Hello.g4 \u6240\u5728\u76ee\u5f55\u521b\u5efa\u4e00\u4e2a ast \u6587\u4ef6\u5939"),(0,r.kt)("li",{parentName:"ol"},"\u5728 ast \u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a ast.go \u6587\u4ef6\uff0c\u5b9e\u73b0gen.HelloVisitor \u63a5\u53e3\uff0c\u5927\u81f4\u5185\u5bb9\u5982\u4e0b")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'package ast\n\nimport (\n   "fmt"\n\n   "hello/gen"\n\n   "github.com/antlr/antlr4/runtime/Go/antlr"\n)\n\ntype Expr struct {\n   Line   uint\n   Column uint\n   Text   string\n}\n\ntype HelloSpec struct {\n   Statements []HelloStatement\n}\n\ntype HelloStatement struct {\n   HelloExpr Expr\n   MsgExpr   Expr\n}\n\ntype HelloVisitor struct {\n   *antlr.BaseParseTreeVisitor\n}\n\nfunc (h *HelloVisitor) VisitHello(ctx *gen.HelloContext) interface{} {\n   var list HelloSpec\n   for _, e := range ctx.AllSpec() {\n      spec := e.Accept(h)\n      if statement, ok := spec.(HelloStatement); ok {\n         list.Statements = append(list.Statements, statement)\n      }\n   }\n   return list\n}\n\nfunc (h *HelloVisitor) VisitSpec(ctx *gen.SpecContext) interface{} {\n   if len(ctx.AllID()) != 2 {\n      panic("invalid statement")\n   }\n   var statement HelloStatement\n   hello := ctx.ID(0)\n   msg := ctx.ID(1)\n\n   statement.HelloExpr = h.getExpr(hello)\n   statement.MsgExpr = h.getExpr(msg)\n   if statement.HelloExpr.Text != "Hello" {\n      panic(\n         fmt.Sprintf(\n            "Expected Hello, actual is %q", statement.HelloExpr.Text,\n         ),\n      )\n   }\n   return statement\n}\n\nfunc (h *HelloVisitor) getExpr(node antlr.TerminalNode) Expr {\n   return Expr{\n      Line:   uint(node.GetSymbol().GetLine()),\n      Column: uint(node.GetSymbol().GetColumn()),\n      Text:   node.GetText(),\n   }\n}\n\ntype Parser struct{}\n\nfunc NewParser() *Parser {\n   return &Parser{}\n}\n\nfunc (p *Parser) Parse(content string) HelloSpec {\n   inputStream := antlr.NewInputStream(content)\n   lexer := gen.NewHelloLexer(inputStream)\n   tokens := antlr.NewCommonTokenStream(lexer, antlr.LexerDefaultTokenChannel)\n   parser := gen.NewHelloParser(tokens)\n   v := parser.Hello().Accept(&HelloVisitor{})\n   if ret, ok := v.(HelloSpec); ok {\n      return ret\n   }\n   return HelloSpec{}\n}\n')),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"\u9a8c\u8bc1\u8bed\u6cd5\u89e3\u6790\uff0c\u7f16\u5199ast_test.go")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'package ast\n\nimport (\n   "bytes"\n   "testing"\n)\n\nfunc TestParse(t *testing.T) {\n   parser := NewParser()\n   expected := `Hello World\nHello gozero\nHello keson\n`\n   spec := parser.Parse(expected)\n   writer := bytes.NewBuffer(nil)\n   for _, e := range spec.Statements {\n      writer.WriteString(e.HelloExpr.Text)\n      writer.WriteString(" ")\n      writer.WriteString(e.MsgExpr.Text)\n      writer.WriteRune(\'\\n\')\n   }\n   actual := writer.String()\n   if actual != expected {\n      t.Fatalf("expected %v got %v\\n", expected, actual)\n   }\n}\n')),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"\u8fd0\u884c\u5355\u6d4b")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"=== RUN   TestParse\n--- PASS: TestParse (0.00s)\nPASS\n")),(0,r.kt)("h4",{id:"32-\u9009\u6210\u719f\u7684-dsl"},"3.2 \u9009\u6210\u719f\u7684 DSL"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"proto"),(0,r.kt)("li",{parentName:"ul"},"thrift"),(0,r.kt)("li",{parentName:"ul"},"\u57fa\u4e8e golang \u8bed\u6cd5\u6269\u5c55\uff1a\u53c2\u8003 swagger \u601d\u60f3")),(0,r.kt)("h3",{id:"4-\u8bed\u6cd5\u89e3\u6790parser"},"4. \u8bed\u6cd5\u89e3\u6790(Parser)"),(0,r.kt)("p",null,"   \u5c06\u5bf9\u5e94 DSL \u63cf\u8ff0\u6587\u4ef6\u5185\u5bb9\u8f6c\u6362\u4e3a\u9700\u8981\u7684 Golang \u7ed3\u6784\u4f53\uff0c\u5982\u4e0a\u6587\u7684 ANTLR \u793a\u4f8b"),(0,r.kt)("h3",{id:"5-\u6570\u636e\u9a71\u52a8render"},"5. \u6570\u636e\u9a71\u52a8(Render)"),(0,r.kt)("p",null,"   \u5229\u7528\u4ece DSL \u8f6c\u6362\u8fc7\u6765\u7684\u7ed3\u6784\u4f53\u6570\u636e\u914d\u5408 Golang \u6a21\u677f\u8fdb\u884c\u6570\u636e\u6e32\u67d3"),(0,r.kt)("h3",{id:"6-\u4ee3\u7801\u683c\u68c0\u67e5inspections"},"6. \u4ee3\u7801\u683c\u68c0\u67e5(Inspections)"),(0,r.kt)("p",null,"   \u5bf9\u751f\u6210\u7684\u4ee3\u7801\u505a\u8bed\u6cd5\u68c0\u67e5\uff0c\u4ee3\u7801\u683c\u5f0f\u5316"),(0,r.kt)("h2",{id:"\u6269\u5c55\u9605\u8bfb"},"\u6269\u5c55\u9605\u8bfb"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://cobra.dev/"},"Cobra: A Framework for Modern CLI Apps in Go")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://tomassetti.me/ebnf/"},"EBNF: How to Describe the Grammar of a Language")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://go.dev/ref/spec"},"The Go Programming Language Specification")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://www.antlr.org/"},"ANTLR")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("a",{parentName:"li",href:"https://pkg.go.dev/text/template"},"Golang: template package"))))}m.isMDXComponent=!0},1619:function(e,t,n){t.Z=n.p+"assets/images/19be3691-7a4a-4d49-adfa-a90551b4e51c-936a090852e83cb9f12cf891a06919bb.png"},7810:function(e,t,n){t.Z=n.p+"assets/images/3b472527-21c3-419b-922c-6e8a6d73072f-2823a70c0f51361fb3a2da7dd3f04ad3.png"},4645:function(e,t,n){t.Z=n.p+"assets/images/3d7481a0-5dc0-46ea-bd25-f0dff87149f2-578b47b9c42864869b6c8eb8abff256c.png"},7392:function(e,t,n){t.Z=n.p+"assets/images/6a8efdf9-cef5-4ea2-b167-30a474dd6f18-74e77e51bdac1b870336009aa269f5d3.png"},9495:function(e,t,n){t.Z=n.p+"assets/images/77a7777c-8181-4ec0-b9bd-949df222b21a-6ed5f87420a81d99e51b503e1dc26c0e.png"},4906:function(e,t,n){t.Z=n.p+"assets/images/8b76c6e1-e137-49ed-8d89-e745065d13d6-c8a9323d0fa3b4e591fd3aff8a4b1875.png"},6165:function(e,t,n){t.Z=n.p+"assets/images/a472383c-815a-405e-ae94-9295fc156959-c5a39ccf453c5a35b60d6c43c3c7d5df.png"},6777:function(e,t,n){t.Z=n.p+"assets/images/bfca4b7b-4601-4a4d-abec-e0bd4b248dd2-b45740764462bc56c34e0826fd482503.png"},2e3:function(e,t,n){t.Z=n.p+"assets/images/e0287a5a-8843-4221-b71d-1ff386ee1aa0-63f859d4ee32feda9e2b91f2b14514cb.png"},9591:function(e,t,n){t.Z=n.p+"assets/images/f9be3959-6f4f-4295-b94e-3e4546383f50-5b8b3bd1a27029ff92b897e8d896485b.png"}}]);