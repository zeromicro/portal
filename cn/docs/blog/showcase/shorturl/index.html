<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3">
<meta httpequiv="x-ua-compatible" content="ie=edge">
<meta property="og:type" content="website">
<meta name="author" content="anqiansong">
<meta name="generator" content="Docusaurus v2.0.0-alpha.75">
<link href="https://www.googletagmanager.com" rel="dns-prefetch">
<link href="https://www.google-analytics.com" rel="dns-prefetch">
<link rel="icon" href="https://zero.keson.dev/favicon.png">
<link rel="icon" href="https://zero.keson.dev/favicon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="https://zero.keson.dev/img/icons/apple-180x180.png" sizes="180x180">
<meta name="msapplication-config" content="/browserconfig.xml">
<link rel="sitemap" type="application/xml" href="/sitemap.xml">
<link rel="alternate" type="application/rss+xml" href="/cn/blog/rss.xml" title="go-zero Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/cn/blog/atom.xml" title="go-zero Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XZD0YKV3XQ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XZD0YKV3XQ",{anonymize_ip:!0})</script>
<link rel="manifest" href="//manifest.webmanifest">
<meta name="theme-color" content="#d14671">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#21222c"><title data-react-helmet="true">å¿«é€Ÿæ„å»ºé«˜å¹¶å‘å¾®æœåŠ¡ | go-zero</title><meta data-react-helmet="true" property="og:image" content><meta data-react-helmet="true" name="twitter:image" content><meta data-react-helmet="true" name="twitter:description" content="go-zero æ˜¯ä¸€ä¸ªé›†æˆäº†å„ç§å·¥ç¨‹å®è·µçš„ web å’Œ rpc æ¡†æ¶ã€‚é€šè¿‡å¼¹æ€§è®¾è®¡ä¿éšœäº†å¤§å¹¶å‘æœåŠ¡ç«¯çš„ç¨³å®šæ€§ï¼Œç»å—äº†å……åˆ†çš„å®æˆ˜æ£€éªŒã€‚"><meta data-react-helmet="true" name="twitter:title" content="Introduction | go-zero"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for &quot;Introduction | go-zero&quot;"><meta data-react-helmet="true" property="og:title" content="å¿«é€Ÿæ„å»ºé«˜å¹¶å‘å¾®æœåŠ¡ | go-zero"><meta data-react-helmet="true" name="description" content="0. ä¸ºä»€ä¹ˆè¯´åšå¥½å¾®æœåŠ¡å¾ˆéš¾"><meta data-react-helmet="true" property="og:description" content="0. ä¸ºä»€ä¹ˆè¯´åšå¥½å¾®æœåŠ¡å¾ˆéš¾"><link rel="stylesheet" href="/cn/assets/css/styles.1ca73be8.css">
</head>
<body itemscope itemtype="http://schema.org/Organization">
<meta itemprop="name" content="">
<meta itemprop="description" content="go-zero æ˜¯ä¸€ä¸ªé›†æˆäº†å„ç§å·¥ç¨‹å®è·µçš„ web å’Œ rpc æ¡†æ¶ã€‚é€šè¿‡å¼¹æ€§è®¾è®¡ä¿éšœäº†å¤§å¹¶å‘æœåŠ¡ç«¯çš„ç¨³å®šæ€§ï¼Œç»å—äº†å……åˆ†çš„å®æˆ˜æ£€éªŒã€‚">
<meta itemprop="url" content="https://zero.keson.dev">
<meta itemprop="logo" content="https://zero.keson.dev/img/favicon.png">
<meta itemprop="sameAs" content="https://github.com/zeromicro">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar_wBc8 navbar--light navbar--fixed-top"><div class="navbar__inner inner_Y8Z6"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="brand_AtiA" href="/cn/"><img alt="logo" height="30" src="/cn/img/navbar/logo.svg" class="brand_logo_MqNk"><a class="navbar__brand brand_name_O39n">go-zero</a></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">æ–‡æ¡£</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/prepare/prepare">ç¯å¢ƒå‡†å¤‡</a></li><li><a class="dropdown__link" href="/cn/docs/quick-start/quick-start">å¿«é€Ÿå¼€å§‹</a></li><li><a class="dropdown__link" href="/cn/docs/advance/advance">è¿›é˜¶æŒ‡å—</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" sidebarid="goctl">Goctl</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/goctl/installation">å®‰è£…</a></li><li><a class="dropdown__link" href="/cn/docs/goctl/api">API æŒ‡ä»¤</a></li><li><a class="dropdown__link" href="/cn/docs/goctl/zrpc">RPC æŒ‡ä»¤</a></li><li><a class="dropdown__link" href="/cn/docs/goctl/model">Model æŒ‡ä»¤</a></li><li><a class="dropdown__link" href="/cn/docs/goctl/completion">è‡ªåŠ¨è¡¥å…¨</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">ç”Ÿæ€</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/eco/plugins">Goctl æ’ä»¶</a></li><li><a class="dropdown__link" href="/cn/docs/eco/editor">ç¼–è¾‘å™¨æ’ä»¶</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">ç¤¾åŒº</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/community/about-us">å…³äºæˆ‘ä»¬</a></li><li><a class="dropdown__link" href="/cn/docs/community/showcase">æ¡ˆä¾‹å±•ç¤º</a></li><li><a class="dropdown__link" href="/cn/docs/community/contribute">å‚ä¸è´¡çŒ®</a></li><li><a class="dropdown__link" href="/cn/docs/community/contributor">è´¡çŒ®äººå‘˜</a></li><li><a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub</a></li><li><a href="https://discord.gg/4JQvC5A4Fe" target="_blank" rel="noopener noreferrer" class="dropdown__link">Discord</a></li></ul></div><a class="navbar__item navbar__link" sidebarid="blog" href="/cn/docs/blog/blog">åšå®¢</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">æ›´å¤š</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cn/docs/resource-center/learning-resource">èµ„æºä¸­å¿ƒ</a></li><li><a href="https://space.bilibili.com/389552232/channel/seriesdetail?sid=2122723" target="_blank" rel="noopener noreferrer" class="dropdown__link">è§†é¢‘æ•™ç¨‹</a></li><li><a href="https://github.com/zeromicro/go-zero/blob/master/ROADMAP.md" target="_blank" rel="noopener noreferrer" class="dropdown__link">å¼€å‘è·¯çº¿å›¾</a></li><li><a class="dropdown__link" href="/cn/docs/design/design">è®¾è®¡æ–‡æ¡£</a></li><li><a class="dropdown__link" href="/cn/docs/faq/troubleshooting">FAQ</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="searchWrapper_f8aU"><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_CDc6"><kbd class="searchHint_2RRg">ctrl</kbd><kbd class="searchHint_2RRg">K</kbd></div></div></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>ä¸­æ–‡ç®€ä½“</span></span></a><ul class="dropdown__menu"><li><a href="/docs/blog/showcase/shorturl" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/cn/docs/blog/showcase/shorturl" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">ä¸­æ–‡ç®€ä½“</a></li></ul></div><a href="https://github.com/zeromicro/go-zero" class="navbar__items navbar__items--right"><img alt="forks" height="30" src="/cn/img/navbar/github.svg" class="star__fork_dBtt"><div class="star_fork_layout_ROo5"><img alt="stars" height="20" src="https://img.shields.io/github/stars/zeromicro/go-zero?style=social" class="star__fork_dBtt"><img alt="forks" height="20" src="https://img.shields.io/github/forks/zeromicro/go-zero?style=social" class="star__fork_dBtt"></div></a><div class="react-toggle themeToggleInHeading_b3Mq react-toggle--checked react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV" style="margin-left:2px">ğŸŒ™</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV" style="margin-left:1px">â˜€</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand brand_AtiA" href="/cn/">go-zero</a><div class="react-toggle themeToggleInSidebar_qGRI react-toggle--checked react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV" style="margin-left:2px">ğŸŒ™</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV" style="margin-left:1px">â˜€</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist"><span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>Languages</span></span></a><ul class="menu__list"><li class="menu__list-item"><a href="/docs/blog/showcase/shorturl" target="_self" rel="noopener noreferrer" class="menu__link" style="text-transform:capitalize">English</a></li><li class="menu__list-item"><a href="/cn/docs/blog/showcase/shorturl" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active" style="text-transform:capitalize">ä¸­æ–‡ç®€ä½“</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">æ–‡æ¡£</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cn/docs/prepare/prepare">ç¯å¢ƒå‡†å¤‡</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/quick-start/quick-start">å¿«é€Ÿå¼€å§‹</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/advance/advance">è¿›é˜¶æŒ‡å—</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist" sidebarid="goctl">Goctl</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cn/docs/goctl/installation">å®‰è£…</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/goctl/api">API æŒ‡ä»¤</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/goctl/zrpc">RPC æŒ‡ä»¤</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/goctl/model">Model æŒ‡ä»¤</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/goctl/completion">è‡ªåŠ¨è¡¥å…¨</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">ç”Ÿæ€</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cn/docs/eco/plugins">Goctl æ’ä»¶</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/eco/editor">ç¼–è¾‘å™¨æ’ä»¶</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">ç¤¾åŒº</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cn/docs/community/about-us">å…³äºæˆ‘ä»¬</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/community/showcase">æ¡ˆä¾‹å±•ç¤º</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/community/contribute">å‚ä¸è´¡çŒ®</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/community/contributor">è´¡çŒ®äººå‘˜</a></li><li class="menu__list-item"><a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://discord.gg/4JQvC5A4Fe" target="_blank" rel="noopener noreferrer" class="menu__link">Discord</a></li></ul></li><li class="menu__list-item"><a class="menu__link" sidebarid="blog" href="/cn/docs/blog/blog">åšå®¢</a></li><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">æ›´å¤š</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cn/docs/resource-center/learning-resource">èµ„æºä¸­å¿ƒ</a></li><li class="menu__list-item"><a href="https://space.bilibili.com/389552232/channel/seriesdetail?sid=2122723" target="_blank" rel="noopener noreferrer" class="menu__link">è§†é¢‘æ•™ç¨‹</a></li><li class="menu__list-item"><a href="https://github.com/zeromicro/go-zero/blob/master/ROADMAP.md" target="_blank" rel="noopener noreferrer" class="menu__link">å¼€å‘è·¯çº¿å›¾</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/design/design">è®¾è®¡æ–‡æ¡£</a></li><li class="menu__list-item"><a class="menu__link" href="/cn/docs/faq/troubleshooting">FAQ</a></li></ul></li></ul></div></div></div></nav><div class="wrapper_DIJ0"><div class="doc_D+rh"><div class="doc__sidebar_gVFN" role="complementary"><div class="sidebar_LIo8"><div class="menu menu--responsive thin-scrollbar menu_oAhv"><button aria-label="æ‰“å¼€" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_nrF-" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" href="/cn/docs/blog/blog">åšå®¢</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">æœåŠ¡æ²»ç†</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/governance/bloom">bloom</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/governance/breaker-algorithms">ç†”æ–­åŸç†ä¸å®ç°</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/governance/loadshedding">æœåŠ¡è‡ªé€‚åº”é™è½½ä¿æŠ¤è®¾è®¡</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/governance/periodlimit">periodlimit</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/governance/tokenlimit">tokenlimit</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">ç¼“å­˜è®¾è®¡</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/cache/cache">DBç¼“å­˜æœºåˆ¶</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/cache/redis-cache">go-zeroç¼“å­˜è®¾è®¡ä¹‹æŒä¹…å±‚ç¼“å­˜</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/cache/business-cache">go-zeroç¼“å­˜è®¾è®¡ä¹‹ä¸šåŠ¡å±‚ç¼“å­˜</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/cache/collection">é€šè¿‡ collection.Cache è¿›è¡Œç¼“å­˜</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">ç»„ä»¶ä»‹ç»</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/tool/executors">executors</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/tool/keywords">é«˜æ•ˆçš„å…³é”®è¯æ›¿æ¢å’Œæ•æ„Ÿè¯è¿‡æ»¤å·¥å…·</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/tool/logx">logx</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">å¹¶å‘ç¼–ç¨‹</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/concurrency/fx">æ•°æ®çš„æµå¤„ç†åˆ©å™¨</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/concurrency/mapreduce">é€šè¿‡MapReduceé™ä½æœåŠ¡å“åº”æ—¶é—´</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/concurrency/stream">æµæ•°æ®å¤„ç†åˆ©å™¨</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/concurrency/redis-lock">redis lock</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/concurrency/sharedcalls">é˜²æ­¢ç¼“å­˜å‡»ç©¿ä¹‹è¿›ç¨‹å†…å…±äº«è°ƒç”¨</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">åŸç†ä»‹ç»</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/principle/timing-wheel">TimingWheel</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u menu__link--sublist menu__link--active" href="#!">æ¡ˆä¾‹å±•ç¤º</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menuLink_Zq3u menu__link--active active" tabindex="0" href="/cn/docs/blog/showcase/shorturl">å¿«é€Ÿæ„å»ºé«˜å¹¶å‘å¾®æœåŠ¡</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/cn/docs/blog/showcase/zrpc">ä¼ä¸šçº§RPCæ¡†æ¶zRPC</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/cn/docs/blog/showcase/mysql">mysql</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/cn/docs/blog/showcase/mapping">æ–‡æœ¬åºåˆ—åŒ–å’Œååºåˆ—åŒ–</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/cn/docs/blog/showcase/datacenter">æˆ‘æ˜¯å¦‚ä½•ç”¨ go-zero å®ç°ä¸€ä¸ªä¸­å°ç³»ç»Ÿ</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/cn/docs/blog/showcase/go-queue">go-zero åˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/cn/docs/blog/showcase/go-zero-looklook">ä½¿ç”¨go-zeroå¼€å‘ä¸€ä¸ªæ—…æ¸¸ç³»ç»Ÿgo-zero-looklook</a></li><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="0" href="/cn/docs/blog/showcase/metric">åŸºäºprometheusçš„å¾®æœåŠ¡æŒ‡æ ‡ç›‘æ§</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menuLink_Zq3u menu__link--sublist" href="#!">çº¿ä¸Šäº¤æµ</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLink_Zq3u" tabindex="-1" href="/cn/docs/blog/share/online-exchange">10æœˆ3æ—¥çº¿ä¸Šäº¤æµé—®é¢˜æ±‡æ€»</a></li></ul></li></ul></div></div></div><main class="doc__main_VklL"><div class="padding-vert--lg container doc__item-wrapper_FIxd"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><header><h1 class="docTitle_-X99">å¿«é€Ÿæ„å»ºé«˜å¹¶å‘å¾®æœåŠ¡</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="0-ä¸ºä»€ä¹ˆè¯´åšå¥½å¾®æœåŠ¡å¾ˆéš¾"></a>0. ä¸ºä»€ä¹ˆè¯´åšå¥½å¾®æœåŠ¡å¾ˆéš¾<a class="hash-link" href="#0-ä¸ºä»€ä¹ˆè¯´åšå¥½å¾®æœåŠ¡å¾ˆéš¾" title="è·³è½¬åˆ°æ ‡é¢˜">#</a></h2><p>è¦æƒ³åšå¥½å¾®æœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£å’ŒæŒæ¡çš„çŸ¥è¯†ç‚¹éå¸¸å¤šï¼Œä»å‡ ä¸ªç»´åº¦ä¸Šæ¥è¯´ï¼š</p><ul><li><p>åŸºæœ¬åŠŸèƒ½å±‚é¢</p><ol><li>å¹¶å‘æ§åˆ¶ &amp; é™æµï¼Œé¿å…æœåŠ¡è¢«çªå‘æµé‡å‡»å®</li><li>æœåŠ¡æ³¨å†Œä¸æœåŠ¡å‘ç°ï¼Œç¡®ä¿èƒ½å¤ŸåŠ¨æ€ä¾¦æµ‹å¢å‡çš„èŠ‚ç‚¹</li><li>è´Ÿè½½å‡è¡¡ï¼Œéœ€è¦æ ¹æ®èŠ‚ç‚¹æ‰¿å—èƒ½åŠ›åˆ†å‘æµé‡</li><li>è¶…æ—¶æ§åˆ¶ï¼Œé¿å…å¯¹å·²è¶…æ—¶è¯·æ±‚åšæ— ç”¨åŠŸ</li><li>ç†”æ–­è®¾è®¡ï¼Œå¿«é€Ÿå¤±è´¥ï¼Œä¿éšœæ•…éšœèŠ‚ç‚¹çš„æ¢å¤èƒ½åŠ›</li></ol></li><li><p>é«˜é˜¶åŠŸèƒ½å±‚é¢</p><ol><li>è¯·æ±‚è®¤è¯ï¼Œç¡®ä¿æ¯ä¸ªç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®</li><li>é“¾è·¯è¿½è¸ªï¼Œç”¨äºç†è§£æ•´ä¸ªç³»ç»Ÿå’Œå¿«é€Ÿå®šä½ç‰¹å®šè¯·æ±‚çš„é—®é¢˜</li><li>æ—¥å¿—ï¼Œç”¨äºæ•°æ®æ”¶é›†å’Œé—®é¢˜å®šä½</li><li>å¯è§‚æµ‹æ€§ï¼Œæ²¡æœ‰åº¦é‡å°±æ²¡æœ‰ä¼˜åŒ–</li></ol></li></ul><p>å¯¹äºå…¶ä¸­æ¯ä¸€ç‚¹ï¼Œæˆ‘ä»¬éƒ½éœ€è¦ç”¨å¾ˆé•¿çš„ç¯‡å¹…æ¥è®²è¿°å…¶åŸç†å’Œå®ç°ï¼Œé‚£ä¹ˆå¯¹æˆ‘ä»¬åç«¯å¼€å‘è€…æ¥è¯´ï¼Œè¦æƒ³æŠŠè¿™äº›çŸ¥è¯†ç‚¹éƒ½æŒæ¡å¹¶è½å®åˆ°ä¸šåŠ¡ç³»ç»Ÿé‡Œï¼Œéš¾åº¦æ˜¯éå¸¸å¤§çš„ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥ä¾èµ–å·²ç»è¢«å¤§æµé‡éªŒè¯è¿‡çš„æ¡†æ¶ä½“ç³»ã€‚<a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer">go-zero å¾®æœåŠ¡æ¡†æ¶</a>å°±æ˜¯ä¸ºæ­¤è€Œç”Ÿã€‚</p><p>å¦å¤–ï¼Œæˆ‘ä»¬å§‹ç»ˆç§‰æ‰¿ <strong>å·¥å…·å¤§äºçº¦å®šå’Œæ–‡æ¡£</strong> çš„ç†å¿µã€‚æˆ‘ä»¬å¸Œæœ›å°½å¯èƒ½å‡å°‘å¼€å‘äººå‘˜çš„å¿ƒæ™ºè´Ÿæ‹…ï¼ŒæŠŠç²¾åŠ›éƒ½æŠ•å…¥åˆ°äº§ç”Ÿä¸šåŠ¡ä»·å€¼çš„ä»£ç ä¸Šï¼Œå‡å°‘é‡å¤ä»£ç çš„ç¼–å†™ï¼Œæ‰€ä»¥æˆ‘ä»¬å¼€å‘äº† <code>goctl</code> å·¥å…·ã€‚</p><p>ä¸‹é¢æˆ‘é€šè¿‡çŸ­é“¾å¾®æœåŠ¡æ¥æ¼”ç¤ºé€šè¿‡ <a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer">go-zero</a> å¿«é€Ÿçš„åˆ›å»ºå¾®æœåŠ¡çš„æµç¨‹ï¼Œèµ°å®Œä¸€éï¼Œä½ å°±ä¼šå‘ç°ï¼šåŸæ¥ç¼–å†™å¾®æœåŠ¡å¦‚æ­¤ç®€å•ï¼</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="1-ä»€ä¹ˆæ˜¯çŸ­é“¾æœåŠ¡"></a>1. ä»€ä¹ˆæ˜¯çŸ­é“¾æœåŠ¡<a class="hash-link" href="#1-ä»€ä¹ˆæ˜¯çŸ­é“¾æœåŠ¡" title="è·³è½¬åˆ°æ ‡é¢˜">#</a></h2><p>çŸ­é“¾æœåŠ¡å°±æ˜¯å°†é•¿çš„ URL ç½‘å€ï¼Œé€šè¿‡ç¨‹åºè®¡ç®—ç­‰æ–¹å¼ï¼Œè½¬æ¢ä¸ºç®€çŸ­çš„ç½‘å€å­—ç¬¦ä¸²ã€‚</p><p>å†™æ­¤çŸ­é“¾æœåŠ¡æ˜¯ä¸ºäº†ä»æ•´ä½“ä¸Šæ¼”ç¤º go-zero æ„å»ºå®Œæ•´å¾®æœåŠ¡çš„è¿‡ç¨‹ï¼Œç®—æ³•å’Œå®ç°ç»†èŠ‚å°½å¯èƒ½ç®€åŒ–äº†ï¼Œæ‰€ä»¥è¿™ä¸æ˜¯ä¸€ä¸ªé«˜é˜¶çš„çŸ­é“¾æœåŠ¡ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="2-çŸ­é“¾å¾®æœåŠ¡æ¶æ„å›¾"></a>2. çŸ­é“¾å¾®æœåŠ¡æ¶æ„å›¾<a class="hash-link" href="#2-çŸ­é“¾å¾®æœåŠ¡æ¶æ„å›¾" title="è·³è½¬åˆ°æ ‡é¢˜">#</a></h2><img src="https://raw.githubusercontent.com/zeromicro/zero-doc/main/doc/images/shorturl-arch.png" alt="æ¶æ„å›¾" width="800"><ul><li>è¿™é‡Œåªç”¨äº† <code>Transform RPC</code> ä¸€ä¸ªå¾®æœåŠ¡ï¼Œå¹¶ä¸æ˜¯è¯´ API Gateway åªèƒ½è°ƒç”¨ä¸€ä¸ªå¾®æœåŠ¡ï¼Œåªæ˜¯ä¸ºäº†æœ€ç®€æ¼”ç¤º API Gateway å¦‚ä½•è°ƒç”¨ RPC å¾®æœåŠ¡è€Œå·²</li><li>åœ¨çœŸæ­£é¡¹ç›®é‡Œè¦å°½å¯èƒ½æ¯ä¸ªå¾®æœåŠ¡ä½¿ç”¨è‡ªå·±çš„æ•°æ®åº“ï¼Œæ•°æ®è¾¹ç•Œè¦æ¸…æ™°</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="3-goctl-å„å±‚ä»£ç ç”Ÿæˆä¸€è§ˆ"></a>3. goctl å„å±‚ä»£ç ç”Ÿæˆä¸€è§ˆ<a class="hash-link" href="#3-goctl-å„å±‚ä»£ç ç”Ÿæˆä¸€è§ˆ" title="è·³è½¬åˆ°æ ‡é¢˜">#</a></h2><p>æ‰€æœ‰ç»¿è‰²èƒŒæ™¯çš„åŠŸèƒ½æ¨¡å—æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼ŒæŒ‰éœ€æ¿€æ´»ï¼Œçº¢è‰²æ¨¡å—æ˜¯éœ€è¦è‡ªå·±å†™çš„ï¼Œä¹Ÿå°±æ˜¯å¢åŠ ä¸‹ä¾èµ–ï¼Œç¼–å†™ä¸šåŠ¡ç‰¹æœ‰é€»è¾‘ï¼Œå„å±‚ç¤ºæ„å›¾åˆ†åˆ«å¦‚ä¸‹ï¼š</p><ul><li><p>API Gateway</p><img src="https://raw.githubusercontent.com/zeromicro/zero-doc/main/doc/images/shorturl-api.png" alt="api" width="800"></li><li><p>RPC</p><img src="https://raw.githubusercontent.com/zeromicro/zero-doc/main/doc/images/shorturl-rpc.png" alt="æ¶æ„å›¾" width="800"></li><li><p>model</p><img src="https://raw.githubusercontent.com/zeromicro/zero-doc/main/doc/images/shorturl-model.png" alt="model" width="800"></li></ul><p>ä¸‹é¢æˆ‘ä»¬æ¥ä¸€èµ·å®Œæ•´èµ°ä¸€éå¿«é€Ÿæ„å»ºå¾®æœåŠ¡çš„æµç¨‹ï¼ŒLetâ€™s <code>Go</code>!ğŸƒâ€â™‚ï¸</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="4-å‡†å¤‡å·¥ä½œ"></a>4. å‡†å¤‡å·¥ä½œ<a class="hash-link" href="#4-å‡†å¤‡å·¥ä½œ" title="è·³è½¬åˆ°æ ‡é¢˜">#</a></h2><ul><li><p>å®‰è£… etcd, mysql, redis</p></li><li><p>å®‰è£… <code>protoc-gen-go</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ go get -u github.com/golang/protobuf/protoc-gen-go@v1.3.2</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div></li><li><p>å®‰è£… <code>protoc</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ </span><span class="token function" style="color:#8be9fd">wget</span><span class="token plain"> https://github.com/protocolbuffers/protobuf/releases/download/v3.14.0/protoc-3.14.0-linux-x86_64.zip</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ </span><span class="token function" style="color:#8be9fd">unzip</span><span class="token plain"> protoc-3.14.0-linux-x86_64.zip</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ </span><span class="token function" style="color:#8be9fd">mv</span><span class="token plain"> bin/protoc /usr/local/bin/</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div></li><li><p>å®‰è£… goctl å·¥å…·</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ </span><span class="token assign-left variable" style="color:#ff79c6">GO111MODULE</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">on </span><span class="token assign-left variable" style="color:#ff79c6">GOPROXY</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">https://goproxy.cn/,direct go get -u github.com/zeromicro/go-zero/tools/goctl</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div></li><li><p>åˆ›å»ºå·¥ä½œç›®å½• <code>shorturl</code> å’Œ <code>shorturl/api</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">mkdir -p shorturl/api</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div></li><li><p>åœ¨ <code>shorturl</code> ç›®å½•ä¸‹æ‰§è¡Œ <code>go mod init shorturl</code> åˆå§‹åŒ– <code>go.mod</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">module shorturl</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">go 1.15</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">require (</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  github.com/golang/mock v1.4.3</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  github.com/golang/protobuf v1.4.2</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  github.com/zeromicro/go-zero v1.3.0</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  golang.org/x/net v0.0.0-20200707034311-ab3426394381</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  google.golang.org/grpc v1.29.1</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">)</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div><p><strong>æ³¨æ„ï¼šè¿™é‡Œå¯èƒ½å­˜åœ¨ grpc ç‰ˆæœ¬ä¾èµ–çš„é—®é¢˜ï¼Œå¯ä»¥ç”¨ä»¥ä¸Šé…ç½®</strong></p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="5-ç¼–å†™-api-gateway-ä»£ç "></a>5. ç¼–å†™ API Gateway ä»£ç <a class="hash-link" href="#5-ç¼–å†™-api-gateway-ä»£ç " title="è·³è½¬åˆ°æ ‡é¢˜">#</a></h2><ul><li><p>åœ¨ <code>shorturl/api</code> ç›®å½•ä¸‹é€šè¿‡ goctl ç”Ÿæˆ <code>api/shorturl.api</code>ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl api -o shorturl.api</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div></li><li><p>ç¼–è¾‘ <code>api/shorturl.api</code>ï¼Œä¸ºäº†ç®€æ´ï¼Œå»é™¤äº†æ–‡ä»¶å¼€å¤´çš„ <code>info</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">type (</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  expandReq {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    shorten string `form:&quot;shorten&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  expandResp {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    url string `json:&quot;url&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">type (</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  shortenReq {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    url string `form:&quot;url&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  shortenResp {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    shorten string `json:&quot;shorten&quot;`</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  }</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">service shorturl-api {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  @server(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    handler: ShortenHandler</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  get /shorten(shortenReq) returns(shortenResp)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  @server(</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    handler: ExpandHandler</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  )</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  get /expand(expandReq) returns(expandResp)</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div><p>type ç”¨æ³•å’Œ go ä¸€è‡´ï¼Œservice ç”¨æ¥å®šä¹‰ get/post/head/delete ç­‰ api è¯·æ±‚ï¼Œè§£é‡Šå¦‚ä¸‹ï¼š</p><ul><li><code>service shorturl-api {</code> è¿™ä¸€è¡Œå®šä¹‰äº† service åå­—</li><li><code>@server</code> éƒ¨åˆ†ç”¨æ¥å®šä¹‰ server ç«¯ç”¨åˆ°çš„å±æ€§</li><li><code>handler</code> å®šä¹‰äº†æœåŠ¡ç«¯ handler åå­—</li><li><code>get /shorten(shortenReq) returns(shortenResp)</code> å®šä¹‰äº† get æ–¹æ³•çš„è·¯ç”±ã€è¯·æ±‚å‚æ•°ã€è¿”å›å‚æ•°ç­‰</li></ul></li><li><p>ä½¿ç”¨ goctl ç”Ÿæˆ API Gateway ä»£ç </p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl api go -api shorturl.api -dir </span><span class="token builtin class-name" style="color:#bd93f9">.</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div><p>ç”Ÿæˆçš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">.</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”œâ”€â”€ api</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”œâ”€â”€ etc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”‚   â””â”€â”€ shorturl-api.yaml         // é…ç½®æ–‡ä»¶</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”œâ”€â”€ internal</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”‚   â”œâ”€â”€ config</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”‚   â”‚   â””â”€â”€ config.go             // å®šä¹‰é…ç½®</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”‚   â”œâ”€â”€ handler</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”‚   â”‚   â”œâ”€â”€ expandhandler.go      // å®ç° expandHandler</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”‚   â”‚   â”œâ”€â”€ routes.go             // å®šä¹‰è·¯ç”±å¤„ç†</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”‚   â”‚   â””â”€â”€ shortenhandler.go     // å®ç° shortenHandler</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”‚   â”œâ”€â”€ logic</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”‚   â”‚   â”œâ”€â”€ expandlogic.go        // å®ç° ExpandLogic</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”‚   â”‚   â””â”€â”€ shortenlogic.go       // å®ç° ShortenLogic</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”‚   â”œâ”€â”€ svc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”‚   â”‚   â””â”€â”€ servicecontext.go     // å®šä¹‰ ServiceContext</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”‚   â””â”€â”€ types</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”‚       â””â”€â”€ types.go              // å®šä¹‰è¯·æ±‚ã€è¿”å›ç»“æ„ä½“</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”œâ”€â”€ shorturl.api</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â””â”€â”€ shorturl.go                   // main å…¥å£å®šä¹‰</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”œâ”€â”€ go.mod</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â””â”€â”€ go.sum</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div></li><li><p>å¯åŠ¨ API Gateway æœåŠ¡ï¼Œé»˜è®¤ä¾¦å¬åœ¨ 8888 ç«¯å£</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ go run shorturl.go -f etc/shorturl-api.yaml</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div></li><li><p>æµ‹è¯• API Gateway æœåŠ¡</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ </span><span class="token function" style="color:#8be9fd">curl</span><span class="token plain"> -i </span><span class="token string" style="color:#f1fa8c">&quot;http://localhost:8888/shorten?url=http://www.xiaoheiban.cn&quot;</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div><p>è¿”å›å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI http"><div tabindex="0" class="prism-code language-http codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">HTTP/1.1 200 OK</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Content-Type: application/json</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Date: Thu, 27 Aug 2020 14:31:39 GMT</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Content-Length: 15</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">{&quot;shorten&quot;:&quot;&quot;}</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ API Gateway å…¶å®å•¥ä¹Ÿæ²¡å¹²ï¼Œå°±è¿”å›äº†ä¸ªç©ºå€¼ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¼šåœ¨ rpc æœåŠ¡é‡Œå®ç°ä¸šåŠ¡é€»è¾‘</p></li><li><p>å¯ä»¥ä¿®æ”¹ <code>internal/svc/servicecontext.go</code> æ¥ä¼ é€’æœåŠ¡ä¾èµ–ï¼ˆå¦‚æœéœ€è¦ï¼‰</p></li><li><p>å®ç°é€»è¾‘å¯ä»¥ä¿®æ”¹ <code>internal/logic</code> ä¸‹çš„å¯¹åº”æ–‡ä»¶</p></li><li><p>å¯ä»¥é€šè¿‡ <code>goctl</code> ç”Ÿæˆå„ç§å®¢æˆ·ç«¯è¯­è¨€çš„ api è°ƒç”¨ä»£ç </p></li><li><p>åˆ°è¿™é‡Œï¼Œä½ å·²ç»å¯ä»¥é€šè¿‡ goctl ç”Ÿæˆå®¢æˆ·ç«¯ä»£ç ç»™å®¢æˆ·ç«¯åŒå­¦å¹¶è¡Œå¼€å‘äº†ï¼Œæ”¯æŒå¤šç§è¯­è¨€ï¼Œè¯¦è§æ–‡æ¡£</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="6-ç¼–å†™-transform-rpc-æœåŠ¡"></a>6. ç¼–å†™ transform rpc æœåŠ¡<a class="hash-link" href="#6-ç¼–å†™-transform-rpc-æœåŠ¡" title="è·³è½¬åˆ°æ ‡é¢˜">#</a></h2><ul><li>åœ¨ <code>shorturl</code> ç›®å½•ä¸‹åˆ›å»º <code>rpc</code> ç›®å½•</li></ul><ul><li><p>åœ¨ <code>rpc/transform</code> ç›®å½•ä¸‹ç¼–å†™ <code>transform.proto</code> æ–‡ä»¶</p><p>å¯ä»¥é€šè¿‡å‘½ä»¤ç”Ÿæˆ proto æ–‡ä»¶æ¨¡æ¿</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl rpc template -o transform.proto</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div><p>ä¿®æ”¹åæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI protobuf"><div tabindex="0" class="prism-code language-protobuf codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">syntax = &quot;proto3&quot;;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">package transform;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">message expandReq {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    string shorten = 1;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">message expandResp {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    string url = 1;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">message shortenReq {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    string url = 1;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">message shortenResp {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    string shorten = 1;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">service transformer {</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    rpc expand(expandReq) returns(expandResp);</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    rpc shorten(shortenReq) returns(shortenResp);</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">}</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div></li><li><p>ç”¨ <code>goctl</code> ç”Ÿæˆ rpc ä»£ç ï¼Œåœ¨ <code>rpc/transform</code> ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl rpc proto -src transform.proto -dir </span><span class="token builtin class-name" style="color:#bd93f9">.</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div><p><strong>æ³¨æ„ï¼šä¸èƒ½åœ¨ GOPATH ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸Šå‘½ä»¤</strong></p><p>æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">rpc/transform</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”œâ”€â”€ etc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â””â”€â”€ transform.yaml              // é…ç½®æ–‡ä»¶</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”œâ”€â”€ internal</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”œâ”€â”€ config</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”‚   â””â”€â”€ config.go               // é…ç½®å®šä¹‰</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”œâ”€â”€ logic</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”‚   â”œâ”€â”€ expandlogic.go          // expand ä¸šåŠ¡é€»è¾‘åœ¨è¿™é‡Œå®ç°</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”‚   â””â”€â”€ shortenlogic.go         // shorten ä¸šåŠ¡é€»è¾‘åœ¨è¿™é‡Œå®ç°</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”œâ”€â”€ server</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â”‚   â””â”€â”€ transformerserver.go    // è°ƒç”¨å…¥å£, ä¸éœ€è¦ä¿®æ”¹</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â””â”€â”€ svc</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚       â””â”€â”€ servicecontext.go       // å®šä¹‰ ServiceContextï¼Œä¼ é€’ä¾èµ–</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”œâ”€â”€ pb</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”‚   â””â”€â”€ transform.pb.go</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”œâ”€â”€ transform.go                    // rpc æœåŠ¡ main å‡½æ•°</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”œâ”€â”€ transform.proto</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â””â”€â”€ transformer</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    â”œâ”€â”€ transformer.go              // æä¾›äº†å¤–éƒ¨è°ƒç”¨æ–¹æ³•ï¼Œæ— éœ€ä¿®æ”¹</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    â”œâ”€â”€ transformer_mock.go         // mock æ–¹æ³•ï¼Œæµ‹è¯•ç”¨</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    â””â”€â”€ types.go                    // request/response ç»“æ„ä½“å®šä¹‰</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div><p>ç›´æ¥å¯ä»¥è¿è¡Œï¼Œå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ go run transform.go -f etc/transform.yaml</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Starting rpc server at 127.0.0.1:8080...</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div><p>æŸ¥çœ‹æœåŠ¡æ˜¯å¦æ³¨å†Œ</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go-zero"><div tabindex="0" class="prism-code language-go-zero codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ ETCDCTL_API=3 etcdctl get transform.rpc --prefix</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">transform.rpc/7587851893787585061</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">127.0.0.1:8080</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div><p><code>etc/transform.yaml</code> æ–‡ä»¶é‡Œå¯ä»¥ä¿®æ”¹ä¾¦å¬ç«¯å£ç­‰é…ç½®</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="7-ä¿®æ”¹-api-gateway-ä»£ç è°ƒç”¨-transform-rpc-æœåŠ¡"></a>7. ä¿®æ”¹ API Gateway ä»£ç è°ƒç”¨ transform rpc æœåŠ¡<a class="hash-link" href="#7-ä¿®æ”¹-api-gateway-ä»£ç è°ƒç”¨-transform-rpc-æœåŠ¡" title="è·³è½¬åˆ°æ ‡é¢˜">#</a></h2><ul><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ <code>shorturl-api.yaml</code>ï¼Œå¢åŠ å¦‚ä¸‹å†…å®¹</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token key atrule">Transform</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">Etcd</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">Hosts</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> localhost</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token number" style="color:#50fa7b">2379</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">Key</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> transform.rpc</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div><p>é€šè¿‡ etcd è‡ªåŠ¨å»å‘ç°å¯ç”¨çš„ transform æœåŠ¡</p></li><li><p>ä¿®æ”¹ <code>internal/config/config.go</code> å¦‚ä¸‹ï¼Œå¢åŠ  transform æœåŠ¡ä¾èµ–</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">type</span><span class="token plain"> Config </span><span class="token keyword" style="color:#ff79c6">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  rest</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">RestConf</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  Transform zrpc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">RpcClientConf</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div></li><li><p>ä¿®æ”¹ <code>internal/svc/servicecontext.go</code>ï¼Œå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">type</span><span class="token plain"> ServiceContext </span><span class="token keyword" style="color:#ff79c6">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  Config    config</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Config</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  Transformer transformer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Transformer</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">NewServiceContext</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c config</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">ServiceContext </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">ServiceContext</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Config</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">    c</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Transformer</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> transformer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">NewTransformer</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">zrpc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">MustNewClient</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Transform</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div><p>é€šè¿‡ ServiceContext åœ¨ä¸åŒä¸šåŠ¡é€»è¾‘ä¹‹é—´ä¼ é€’ä¾èµ–</p></li><li><p>ä¿®æ”¹ <code>internal/logic/expandlogic.go</code> é‡Œçš„ <code>Expand</code> æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">l </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">ExpandLogic</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">Expand</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">req types</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ExpandReq</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">types</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ExpandResp</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// æ‰‹åŠ¨ä»£ç å¼€å§‹</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  resp</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> l</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">svcCtx</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Transformer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Expand</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">l</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">transformer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ExpandReq</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Shorten</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> req</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Shorten</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> types</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ExpandResp</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> types</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ExpandResp</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Url</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> resp</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Url</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// æ‰‹åŠ¨ä»£ç ç»“æŸ</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div></li></ul><p>é€šè¿‡è°ƒç”¨ <code>transformer</code> çš„ <code>Expand</code> æ–¹æ³•å®ç°çŸ­é“¾æ¢å¤åˆ° url</p><ul><li><p>ä¿®æ”¹ <code>internal/logic/shortenlogic.go</code>ï¼Œå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">l </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">ShortenLogic</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">Shorten</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">req types</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ShortenReq</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">types</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ShortenResp</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// æ‰‹åŠ¨ä»£ç å¼€å§‹</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      resp</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> l</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">svcCtx</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Transformer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Shorten</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">l</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">transformer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ShortenReq</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">          Url</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> req</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Url</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> types</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ShortenResp</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> types</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ShortenResp</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">        Shorten</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> resp</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Shorten</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#6272a4">// æ‰‹åŠ¨ä»£ç ç»“æŸ</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div><p>æœ‰çš„ç‰ˆæœ¬ç”Ÿæˆè¿”å›å€¼å¯èƒ½æ˜¯æŒ‡é’ˆç±»å‹ï¼Œéœ€è¦è‡ªå·±è°ƒæ•´ä¸‹</p></li></ul><p>é€šè¿‡è°ƒç”¨ <code>transformer</code> çš„ <code>Shorten</code> æ–¹æ³•å®ç° url åˆ°çŸ­é“¾çš„å˜æ¢</p><p>è‡³æ­¤ï¼ŒAPI Gateway ä¿®æ”¹å®Œæˆï¼Œè™½ç„¶è´´çš„ä»£ç å¤šï¼Œä½†æ˜¯å…¶ä¸­ä¿®æ”¹çš„æ˜¯å¾ˆå°‘çš„ä¸€éƒ¨åˆ†ï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£ä¸Šä¸‹æ–‡ï¼Œæˆ‘è´´äº†å®Œæ•´ä»£ç ï¼Œæ¥ä¸‹æ¥å¤„ç† CRUD+cache</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="8-å®šä¹‰æ•°æ®åº“è¡¨ç»“æ„å¹¶ç”Ÿæˆ-crudcache-ä»£ç "></a>8. å®šä¹‰æ•°æ®åº“è¡¨ç»“æ„ï¼Œå¹¶ç”Ÿæˆ CRUD+cache ä»£ç <a class="hash-link" href="#8-å®šä¹‰æ•°æ®åº“è¡¨ç»“æ„å¹¶ç”Ÿæˆ-crudcache-ä»£ç " title="è·³è½¬åˆ°æ ‡é¢˜">#</a></h2><ul><li><p>shorturl ä¸‹åˆ›å»º <code>rpc/transform/model</code> ç›®å½•ï¼š<code>mkdir -p rpc/transform/model</code></p></li><li><p>åœ¨ <code>rpc/transform/model</code> ç›®å½•ä¸‹ç¼–å†™åˆ›å»º shorturl è¡¨çš„ sql æ–‡ä»¶ <code>shorturl.sql</code>ï¼Œå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sql"><div tabindex="0" class="prism-code language-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#f8f8f2">`</span><span class="token identifier">shorturl</span><span class="token identifier punctuation" style="color:#f8f8f2">`</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#f8f8f2">`</span><span class="token identifier">shorten</span><span class="token identifier punctuation" style="color:#f8f8f2">`</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">varchar</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#50fa7b">255</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;shorten key&#x27;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token identifier punctuation" style="color:#f8f8f2">`</span><span class="token identifier">url</span><span class="token identifier punctuation" style="color:#f8f8f2">`</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">varchar</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#50fa7b">255</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">COMMENT</span><span class="token plain"> </span><span class="token string" style="color:#f1fa8c">&#x27;original url&#x27;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">KEY</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token identifier punctuation" style="color:#f8f8f2">`</span><span class="token identifier">shorten</span><span class="token identifier punctuation" style="color:#f8f8f2">`</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">ENGINE</span><span class="token operator" style="color:#ff79c6">=</span><span class="token keyword" style="color:#ff79c6">InnoDB</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">CHARSET</span><span class="token operator" style="color:#ff79c6">=</span><span class="token plain">utf8mb4</span><span class="token punctuation" style="color:#f8f8f2">;</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div></li><li><p>åˆ›å»º DB å’Œ table</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sql"><div tabindex="0" class="prism-code language-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">create</span><span class="token plain"> </span><span class="token keyword" style="color:#ff79c6">database</span><span class="token plain"> gozero</span><span class="token punctuation" style="color:#f8f8f2">;</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sql"><div tabindex="0" class="prism-code language-sql codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">source shorturl</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token keyword" style="color:#ff79c6">sql</span><span class="token punctuation" style="color:#f8f8f2">;</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div></li><li><p>åœ¨ <code>rpc/transform/model</code> ç›®å½•ä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ç”Ÿæˆ CRUD+cache ä»£ç ï¼Œ<code>-c</code> è¡¨ç¤ºä½¿ç”¨ <code>redis cache</code></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ goctl model mysql ddl -c -src shorturl.sql -dir </span><span class="token builtin class-name" style="color:#bd93f9">.</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div><p>ä¹Ÿå¯ä»¥ç”¨ <code>datasource</code> å‘½ä»¤ä»£æ›¿ <code>ddl</code> æ¥æŒ‡å®šæ•°æ®åº“é“¾æ¥ç›´æ¥ä» schema ç”Ÿæˆ</p><p>ç”Ÿæˆåçš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI Plain"><div tabindex="0" class="prism-code language-Plain codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">rpc/transform/model</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”œâ”€â”€ shorturl.sql</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â”œâ”€â”€ shorturlmodel.go              // CRUD+cache ä»£ç </span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">â””â”€â”€ vars.go                       // å®šä¹‰å¸¸é‡å’Œå˜é‡</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="9-ä¿®æ”¹-shortenexpand-rpc-ä»£ç è°ƒç”¨-crudcache-ä»£ç "></a>9. ä¿®æ”¹ shorten/expand rpc ä»£ç è°ƒç”¨ crud+cache ä»£ç <a class="hash-link" href="#9-ä¿®æ”¹-shortenexpand-rpc-ä»£ç è°ƒç”¨-crudcache-ä»£ç " title="è·³è½¬åˆ°æ ‡é¢˜">#</a></h2><ul><li><p>ä¿®æ”¹ <code>rpc/transform/etc/transform.yaml</code>ï¼Œå¢åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token key atrule">DataSource</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> root</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">password@tcp(localhost</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">3306)/gozero</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">Table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> shorturl</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">Cache</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">Host</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> localhost</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token number" style="color:#50fa7b">6379</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div><p>å¯ä»¥ä½¿ç”¨å¤šä¸ª redis ä½œä¸º cacheï¼Œæ”¯æŒ redis å•ç‚¹æˆ–è€… redis é›†ç¾¤</p></li><li><p>ä¿®æ”¹ <code>rpc/transform/internal/config/config.go</code>ï¼Œå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">type</span><span class="token plain"> Config </span><span class="token keyword" style="color:#ff79c6">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  zrpc</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">RpcServerConf</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  DataSource </span><span class="token builtin" style="color:#bd93f9">string</span><span class="token plain">             </span><span class="token comment" style="color:#6272a4">// æ‰‹åŠ¨ä»£ç </span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  Table      </span><span class="token builtin" style="color:#bd93f9">string</span><span class="token plain">             </span><span class="token comment" style="color:#6272a4">// æ‰‹åŠ¨ä»£ç </span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  Cache      cache</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">CacheConf    </span><span class="token comment" style="color:#6272a4">// æ‰‹åŠ¨ä»£ç </span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div><p>å¢åŠ äº† mysql å’Œ redis cache é…ç½®</p></li><li><p>ä¿®æ”¹ <code>rpc/transform/internal/svc/servicecontext.go</code>ï¼Œå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">type</span><span class="token plain"> ServiceContext </span><span class="token keyword" style="color:#ff79c6">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  c     config</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Config</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  Model model</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ShorturlModel   </span><span class="token comment" style="color:#6272a4">// æ‰‹åŠ¨ä»£ç </span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">NewServiceContext</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c config</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">ServiceContext </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">ServiceContext</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    c</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">             c</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Model</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> model</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">NewShorturlModel</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">sqlx</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">NewMysql</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">DataSource</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Cache</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token comment" style="color:#6272a4">// æ‰‹åŠ¨ä»£ç </span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div></li><li><p>ä¿®æ”¹ <code>rpc/transform/internal/logic/expandlogic.go</code>ï¼Œå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">l </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">ExpandLogic</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">Expand</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">in </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">transform</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ExpandReq</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">transform</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ExpandResp</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// æ‰‹åŠ¨ä»£ç å¼€å§‹</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  res</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> l</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">svcCtx</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Model</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">FindOne</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">l</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> in</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Shorten</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">transform</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ExpandResp</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Url</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> res</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Url</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// æ‰‹åŠ¨ä»£ç ç»“æŸ</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div></li><li><p>ä¿®æ”¹ <code>rpc/transform/internal/logic/shortenlogic.go</code>ï¼Œå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI go"><div tabindex="0" class="prism-code language-go codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#ff79c6">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">l </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">ShortenLogic</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token function" style="color:#8be9fd">Shorten</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">in </span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">transform</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ShortenReq</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#ff79c6">*</span><span class="token plain">transform</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ShortenResp</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#bd93f9">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// æ‰‹åŠ¨ä»£ç å¼€å§‹ï¼Œç”ŸæˆçŸ­é“¾æ¥</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  key </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> hash</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Md5Hex</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token function" style="color:#8be9fd">byte</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">in</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Url</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token number" style="color:#50fa7b">6</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  object</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">_</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> l</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">svcCtx</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Model</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">FindOne</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">l</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> object </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">transform</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ShortenResp</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">      Shorten</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> key</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token boolean" style="color:#bd93f9">_</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">:=</span><span class="token plain"> l</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">svcCtx</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Model</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#8be9fd">Insert</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">l</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">model</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Shorturl</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Shorten</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> key</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Url</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">     in</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Url</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">if</span><span class="token plain"> err </span><span class="token operator" style="color:#ff79c6">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#ff79c6">return</span><span class="token plain"> </span><span class="token operator" style="color:#ff79c6">&amp;</span><span class="token plain">transform</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ShortenResp</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">    Shorten</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> key</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token boolean" style="color:#bd93f9">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#6272a4">// æ‰‹åŠ¨ä»£ç ç»“æŸ</span><span class="token plain"></span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div><p>è‡³æ­¤ä»£ç ä¿®æ”¹å®Œæˆï¼Œå‡¡æ˜¯æ‰‹åŠ¨ä¿®æ”¹çš„ä»£ç æˆ‘åŠ äº†æ ‡æ³¨</p><p><strong>æ³¨æ„ï¼š</strong></p><ol><li>undefined cacheï¼Œä½ éœ€è¦ <code>import &quot;github.com/zeromicro/go-zero/core/stores/cache&quot;</code></li><li>undefined model, sqlx, hash ç­‰ï¼Œä½ éœ€è¦åœ¨æ–‡ä»¶ä¸­</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI golang"><div tabindex="0" class="prism-code language-golang codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">import &quot;shorturl/rpc/transform/model&quot;</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">import &quot;github.com/zeromicro/go-zero/core/stores/sqlx&quot;</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="10-å®Œæ•´è°ƒç”¨æ¼”ç¤º"></a>10. å®Œæ•´è°ƒç”¨æ¼”ç¤º<a class="hash-link" href="#10-å®Œæ•´è°ƒç”¨æ¼”ç¤º" title="è·³è½¬åˆ°æ ‡é¢˜">#</a></h2><ul><li><p>shorten api è°ƒç”¨</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#8be9fd">curl</span><span class="token plain"> -i </span><span class="token string" style="color:#f1fa8c">&quot;http://localhost:8888/shorten?url=http://www.xiaoheiban.cn&quot;</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div><p>è¿”å›å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI http"><div tabindex="0" class="prism-code language-http codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">HTTP/1.1 200 OK</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Content-Type: application/json</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Date: Sat, 29 Aug 2020 10:49:49 GMT</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Content-Length: 21</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">{&quot;shorten&quot;:&quot;f35b2a&quot;}</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div></li><li><p>expand api è°ƒç”¨</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><div tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">$ </span><span class="token function" style="color:#8be9fd">curl</span><span class="token plain"> -i </span><span class="token string" style="color:#f1fa8c">&quot;http://localhost:8888/expand?shorten=f35b2a&quot;</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div><p>è¿”å›å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI http"><div tabindex="0" class="prism-code language-http codeBlock_rtdJ thin-scrollbar"><div class="codeBlockLines_1zSZ" style="color:#f8f8f2;background-color:#262833"><div class="token-line" style="color:#f8f8f2"><span class="token plain">HTTP/1.1 200 OK</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Content-Type: application/json</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Date: Sat, 29 Aug 2020 10:51:53 GMT</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">Content-Length: 34</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#f8f8f2"><span class="token plain">{&quot;url&quot;:&quot;http://www.xiaoheiban.cn&quot;}</span></div></div></div><button type="button" aria-label="ä»£ç å¤åˆ¶" class="copyButton_M3SB">å¤åˆ¶</button></div></div></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="11-benchmark"></a>11. Benchmark<a class="hash-link" href="#11-benchmark" title="è·³è½¬åˆ°æ ‡é¢˜">#</a></h2><p>å› ä¸ºå†™å…¥ä¾èµ–äº mysql çš„å†™å…¥é€Ÿåº¦ï¼Œå°±ç›¸å½“äºå‹ mysql äº†ï¼Œæ‰€ä»¥å‹æµ‹åªæµ‹è¯•äº† expand æ¥å£ï¼Œç›¸å½“äºä» mysql é‡Œè¯»å–å¹¶åˆ©ç”¨ç¼“å­˜ï¼Œshorten.lua é‡Œéšæœºä» db é‡Œè·å–äº† 100 ä¸ªçƒ­ key æ¥ç”Ÿæˆå‹æµ‹è¯·æ±‚</p><p><img src="https://raw.githubusercontent.com/zeromicro/zero-doc/main/doc/images/shorturl-benchmark.png" alt="Benchmark"></p><p>å¯ä»¥çœ‹å‡ºåœ¨æˆ‘çš„ MacBook Pro ä¸Šèƒ½è¾¾åˆ° 3 ä¸‡ + çš„ qpsã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="12-å®Œæ•´ä»£ç "></a>12. å®Œæ•´ä»£ç <a class="hash-link" href="#12-å®Œæ•´ä»£ç " title="è·³è½¬åˆ°æ ‡é¢˜">#</a></h2><p><a href="https://github.com/zeromicro/zero-examples/tree/main/shorturl" target="_blank" rel="noopener noreferrer">https://github.com/zeromicro/zero-examples/tree/main/shorturl</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="12-æ€»ç»“"></a>12. æ€»ç»“<a class="hash-link" href="#12-æ€»ç»“" title="è·³è½¬åˆ°æ ‡é¢˜">#</a></h2><p>æˆ‘ä»¬ä¸€ç›´å¼ºè°ƒ <strong>å·¥å…·å¤§äºçº¦å®šå’Œæ–‡æ¡£</strong>ã€‚</p><p>go-zero ä¸åªæ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œæ›´æ˜¯ä¸€ä¸ªå»ºç«‹åœ¨æ¡†æ¶ + å·¥å…·åŸºç¡€ä¸Šçš„ï¼Œç®€åŒ–å’Œè§„èŒƒäº†æ•´ä¸ªå¾®æœåŠ¡æ„å»ºçš„æŠ€æœ¯ä½“ç³»ã€‚</p><p>æˆ‘ä»¬åœ¨ä¿æŒç®€å•çš„åŒæ—¶ä¹Ÿå°½å¯èƒ½æŠŠå¾®æœåŠ¡æ²»ç†çš„å¤æ‚åº¦å°è£…åˆ°äº†æ¡†æ¶å†…éƒ¨ï¼Œæå¤§çš„é™ä½äº†å¼€å‘äººå‘˜çš„å¿ƒæ™ºè´Ÿæ‹…ï¼Œä½¿å¾—ä¸šåŠ¡å¼€å‘å¾—ä»¥å¿«é€Ÿæ¨è¿›ã€‚</p><p>é€šè¿‡ go-zero+goctl ç”Ÿæˆçš„ä»£ç ï¼ŒåŒ…å«äº†å¾®æœåŠ¡æ²»ç†çš„å„ç§ç»„ä»¶ï¼ŒåŒ…æ‹¬ï¼šå¹¶å‘æ§åˆ¶ã€è‡ªé€‚åº”ç†”æ–­ã€è‡ªé€‚åº”é™è½½ã€è‡ªåŠ¨ç¼“å­˜æ§åˆ¶ç­‰ï¼Œå¯ä»¥è½»æ¾éƒ¨ç½²ä»¥æ‰¿è½½å·¨å¤§è®¿é—®é‡ã€‚</p><p>æœ‰ä»»ä½•å¥½çš„æå‡å·¥ç¨‹æ•ˆç‡çš„æƒ³æ³•ï¼Œéšæ—¶æ¬¢è¿äº¤æµï¼ğŸ‘</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/anqiansong/zeromicro/blob/main/docs/blog/showcase/shorturl.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>ç¼–è¾‘æ­¤é¡µ</a></div><div class="col text--right"><em><small>æœ€åæ›´æ–° æ—¥æœŸï¼š <time datetime="2022-04-30T06:05:09.000Z" class="lastUpdatedDate_nN9m">4/30/2022</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="æ–‡æ¡£é¡µé¢å¯¼èˆª"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/cn/docs/blog/principle/timing-wheel"><div class="pagination-nav__sublabel">ä¸Šä¸€ç¯‡</div><div class="pagination-nav__label">Â« TimingWheel</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/cn/docs/blog/showcase/zrpc"><div class="pagination-nav__sublabel">ä¸‹ä¸€ç¯‡</div><div class="pagination-nav__label">ä¼ä¸šçº§RPCæ¡†æ¶zRPC Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#0-ä¸ºä»€ä¹ˆè¯´åšå¥½å¾®æœåŠ¡å¾ˆéš¾" class="table-of-contents__link">0. ä¸ºä»€ä¹ˆè¯´åšå¥½å¾®æœåŠ¡å¾ˆéš¾</a></li><li><a href="#1-ä»€ä¹ˆæ˜¯çŸ­é“¾æœåŠ¡" class="table-of-contents__link">1. ä»€ä¹ˆæ˜¯çŸ­é“¾æœåŠ¡</a></li><li><a href="#2-çŸ­é“¾å¾®æœåŠ¡æ¶æ„å›¾" class="table-of-contents__link">2. çŸ­é“¾å¾®æœåŠ¡æ¶æ„å›¾</a></li><li><a href="#3-goctl-å„å±‚ä»£ç ç”Ÿæˆä¸€è§ˆ" class="table-of-contents__link">3. goctl å„å±‚ä»£ç ç”Ÿæˆä¸€è§ˆ</a></li><li><a href="#4-å‡†å¤‡å·¥ä½œ" class="table-of-contents__link">4. å‡†å¤‡å·¥ä½œ</a></li><li><a href="#5-ç¼–å†™-api-gateway-ä»£ç " class="table-of-contents__link">5. ç¼–å†™ API Gateway ä»£ç </a></li><li><a href="#6-ç¼–å†™-transform-rpc-æœåŠ¡" class="table-of-contents__link">6. ç¼–å†™ transform rpc æœåŠ¡</a></li><li><a href="#7-ä¿®æ”¹-api-gateway-ä»£ç è°ƒç”¨-transform-rpc-æœåŠ¡" class="table-of-contents__link">7. ä¿®æ”¹ API Gateway ä»£ç è°ƒç”¨ transform rpc æœåŠ¡</a></li><li><a href="#8-å®šä¹‰æ•°æ®åº“è¡¨ç»“æ„å¹¶ç”Ÿæˆ-crudcache-ä»£ç " class="table-of-contents__link">8. å®šä¹‰æ•°æ®åº“è¡¨ç»“æ„ï¼Œå¹¶ç”Ÿæˆ CRUD+cache ä»£ç </a></li><li><a href="#9-ä¿®æ”¹-shortenexpand-rpc-ä»£ç è°ƒç”¨-crudcache-ä»£ç " class="table-of-contents__link">9. ä¿®æ”¹ shorten/expand rpc ä»£ç è°ƒç”¨ crud+cache ä»£ç </a></li><li><a href="#10-å®Œæ•´è°ƒç”¨æ¼”ç¤º" class="table-of-contents__link">10. å®Œæ•´è°ƒç”¨æ¼”ç¤º</a></li><li><a href="#11-benchmark" class="table-of-contents__link">11. Benchmark</a></li><li><a href="#12-å®Œæ•´ä»£ç " class="table-of-contents__link">12. å®Œæ•´ä»£ç </a></li><li><a href="#12-æ€»ç»“" class="table-of-contents__link">12. æ€»ç»“</a></li></ul></div></div></div></div></main></div></div><footer class="footer_rm3y section_bQ6r"><div class="footer__inner_OWoZ section--inner_6-fB"><div class="footer__column_+a5z footer__column--left_4bpB"><div><img alt="go-zero logo" class="footer__logo_ayM4" height="27" src="/cn/img/footer/go-zero.svg" title="go-zero" width="108"><img alt="stars" height="27" src="https://img.shields.io/github/stars/zeromicro/go-zero?style=social" class="footer__logo_ayM4"><img alt="forks" height="27" src="https://img.shields.io/github/forks/zeromicro/go-zero?style=social" class="footer__logo_ayM4"></div><p class="footer__tagline_b1u+">go-zero æ˜¯ä¸€ä¸ªé›†æˆäº†å„ç§å·¥ç¨‹å®è·µçš„ web å’Œ rpc æ¡†æ¶</p><a class="footer__github_okz3 button_f7Ff button--icon_q89D button--secondary_x3vq button--xsmall_fwzy" href="https://github.com/zeromicro/go-zero" rel="noopener noreferrer" target="_blank"><img alt="GitHub logo" height="22" src="/cn/img/github.svg" title="GitHub" width="22">Star us on GitHub</a></div><div class="footer__column_+a5z footer__column--right_FGdI"><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">zeromicro</li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/zero-api" rel="noopener noreferrer" target="_blank">zero-api</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-queue" rel="noopener noreferrer" target="_blank">go-queue</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/awesome-zero" rel="noopener noreferrer" target="_blank">awesome-zero</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/zero-examples" rel="noopener noreferrer" target="_blank">zero-example</a></li></ul></div><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">ç¤¾åŒº</li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-zero" rel="noopener noreferrer" target="_blank">GitHub</a></li><li class="footer__item_K578"><span></span></li></ul></div><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">å‹æƒ…é“¾æ¥</li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://go-zero.dev/cn" rel="noopener noreferrer" target="_blank">æ—§æ–‡æ¡£</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="/cn/blog/blog">åšå®¢</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-zero/blob/master/ROADMAP.md" rel="noopener noreferrer" target="_blank">å¼€å‘è·¯çº¿å›¾</a></li><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://landscape.cncf.io/?selected=go-zero" rel="noopener noreferrer" target="_blank">CNCF</a></li></ul></div><div class="footer__links_5pu0"><ul class="footer__items_3d9P"><li class="footer__title_ulcL">å¾®ä¿¡äºŒç»´ç </li><li class="footer__item_K578"><img alt="å¾®ä¿¡ç¾¤" width="80" src="https://raw.githubusercontent.com/zeromicro/zero-doc/main/doc/images/wechat.jpg" class="footer__img_4fbU"></li></ul></div></div></div><div class="footer__bottom_rXtt"><p class="footer__copyright_9e29">Copyright Â© 2022 zeromicro</p><ul><li class="footer__item_K578"><a class="footer__link_l-+N" href="https://github.com/zeromicro/go-zero/blob/master/LICENSE">License</a></li></ul><p></p></div></footer></div>
<script src="/cn/assets/js/main.b144317f.js" defer="defer"></script>
</body>
</html>